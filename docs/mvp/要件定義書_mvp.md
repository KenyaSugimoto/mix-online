
# Mix Stud Online 要件定義書（MVP）

Version: v0.2  
Last Updated: 2026-02-08

---

# 1. 概要

本アプリは、Stud形式のポーカー3種をリアルタイムオンラインでプレイ可能なWebアプリケーションを提供することを目的とする。

対象ゲーム：

- Stud Hi
- Razz
- Stud Hi-Lo（Stud8）

これらをミックス形式でローテーションし、気軽にMixゲームを楽しめる環境を提供する。

---

# 2. 目的

## 2.1 MVP目的

- 友人同士でオンラインMixゲームを遊べる環境を提供
- 一般公開サービスとして運用可能な品質を目指す

## 2.2 将来展望

- HORSE形式への拡張
- ゲーム種別追加を容易にする拡張可能アーキテクチャの採用

---

# 3. スコープ

## 3.1 MVP対象

- StudHi / Razz / Stud8
- キャッシュゲーム形式
- 公開ロビーからの卓参加
- Googleログイン
- 2〜6人対戦
- リアルタイム対戦
- 離席・切断対応
- ハンド進行同期

## 3.2 MVP対象外

- ランキング
- レーティング
- 仮想通貨/リアルマネー
- 高度なチャット機能

---

# 4. 用語定義

| 用語      | 説明                          |
| --------- | ----------------------------- |
| ハンド    | 1回の配札からショーダウンまで |
| ディール  | ハンドと同義                  |
| SIT OUT   | 席を保持したまま参加停止      |
| LEAVE     | 卓から退席                    |
| Upcard    | 公開カード                    |
| Hole card | 非公開カード                  |

---

# 5. ユーザー要件

## 5.1 認証

- Google OAuthによるログイン必須

## 5.2 卓参加

ユーザーは以下が可能：

- 公開ロビーから卓に参加
- 空席への着席
- 離席（SIT OUT）
- 退席（LEAVE）

### 途中参加

- ハンド進行中に着席した場合、次のハンドから参加
- 次のハンドが始まるまでは現在のハンドを観戦可能

---

# 6. ゲーム仕様

## 6.1 対象ゲーム

| ゲーム | 内容              |
| ------ | ----------------- |
| StudHi | 通常の7 Card Stud |
| Razz   | ローハンド勝利    |
| Stud8  | Hi-Lo分割         |

---

## 6.2 ミックス方式

ゲームは以下順序でローテーションする：

```
StudHi → Razz → Stud8 → 繰り返し
```

### ローテーション単位

- **6ハンドごとに切替**

---

## 6.3 テーブル仕様

| 項目       | 内容             |
| ---------- | ---------------- |
| 最小人数   | 2                |
| 最大人数   | 6                |
| ゲーム形式 | キャッシュゲーム |
| ベット構造 | Fixed Limit      |

---

## 6.4 ステークス仕様

| 項目                      | 金額 |
| ------------------------- | ---- |
| Ante                      | $5   |
| Bring-in                  | $10  |
| Small Bet（Complete含む） | $20  |
| Big Bet                   | $40  |

### ベット上限（キャップ）

- 各Streetにおいて最大5bet（1bet + 4raise）
- ヘッズアップ時はキャップなし

---

## 6.5 チップ管理

### プレイマネー方式

- ログイン時に$4,000（100 Big Bet）を自動付与
- Maxバイイン額: $2,000（50 Big Bet）

### チップ補充

- MVPではチップ補充は不可
- スタックが0になった場合、MVPでは自動的に卓から退席させる

### All-in処理

- チップ不足時、全額ベットでAll-in可能
- All-inプレイヤーはショーダウンまで参加継続
- 他にアクティブプレイヤーが複数いる場合、サイドポットを形成

---

# 7. ゲーム進行仕様

## 7.1 Stud共通ルール

- Ante必須
- Bring-inあり
- 3rd〜7th Street構成
- ショーダウンで勝敗決定

### Bring-in対象者の決定

#### Stud Hi / Stud8

以下の優先順で最も弱いUpcardを持つプレイヤーがBring-inを支払う：

1. ペアかどうか（ペアvsペア無しの場合はペア無しがBring-in、ペア同士の場合はランクが低い方がBring-in）
2. Upcardのランク（A > K > Q > ... > 2）→ A vs 2 の場合は 2 が Bring-in
3. スート（スペード > ハート > ダイヤ > クラブ） → As vs Ah の場合は Ah が Bring-in

#### Razz

以下の優先順で最も弱いUpcardを持つプレイヤーがBring-inを支払う：

1. ペアかどうか（ペアvsペア無しの場合はペアがBring-in、ペア同士の場合はランクが高い方がBring-in）
2. Upcardのランク（2 > 3 > ... > K > A）→ 2 vs A の場合は A が Bring-in
3. スート（クラブ > ダイヤ > ハート > スペード）→ As vs Ah の場合は As が Bring-in

### Street構成

| Street | 配布カード    | ベットサイズ |
| ------ | ------------- | ------------ |
| 3rd    | Hole×2 + Up×1 | Small Bet    |
| 4th    | Up×1          | Small Bet    |
| 5th    | Up×1          | Big Bet      |
| 6th    | Up×1          | Big Bet      |
| 7th    | Hole×1        | Big Bet      |


---

## 7.2 情報公開ルール

### クライアントに送信可能情報

- 自分のHole card
- 全プレイヤーUpcard
- Pot情報
- ベット履歴

### 非公開情報

- 他プレイヤーHole card
- 未配布カード

---

# 8. アクションタイム仕様

## 8.1 通常アクションタイム

- 制限時間: 30秒
- 時間切れ時: Check可能ならCheck、不可ならFold
- タイムバンクは無し

---

# 9. ショーダウン仕様

## 9.1 ショーダウン順序

- 最終Streetでベット/レイズしたプレイヤーから開始
- 以降、時計回りに進行
- 全員Checkの場合、最初にアクションしたプレイヤーから

## 9.2 自動マック

- 既にショーされたハンドに負けている場合、自動的にマック（非公開で捨てる）
- 勝っている場合またはタイの場合は強制ショー

## 9.3 Hi-Lo分割（Stud8）

- Hiハンドと8以下のLoハンドでポット分割
- Lo資格なしの場合、Hiが総取り
- 同一プレイヤーがHi/Lo両方勝利した場合スクープ

---

# 10. 離席・切断仕様

## 10.1 SIT OUT

- 席を保持
- 次ハンドから参加しない

## 10.2 LEAVE

- 席を解放

---

## 10.3 切断時動作

### 切断検知後

アクション期限を超えた場合：

- Check可能 → 自動Check
- Check不可 → 自動Fold
- Bring-in局面 → 自動Bring-inベット

### 連続切断時

- 3ハンド連続で切断状態が継続した場合
- 自動的にLEAVE (席を解放)

---

# 11. ロビー仕様

## 11.1 公開ロビー

表示内容：

- 卓ID / 卓名
- ステークス（$20/$40 Fixed Limit）
- 現在プレイヤー人数 / 最大人数
- 現在ゲーム種別
- 空席数

## 11.2 卓管理

- MVPでは運営者が事前に2卓を作成
- ユーザーによる卓作成は対象外

---

# 12. リアルタイム通信要件

## 12.1 同期モデル

### サーバー権威モデルを採用

- ゲーム状態はサーバーが唯一の正とする
- クライアントは表示専用

---

## 12.2 イベント駆動進行

ゲームはイベントログにより進行する。

主要イベント：

- PostAnteEvent
- BringInEvent
- CompleteEvent
- BetEvent
- RaiseEvent
- CallEvent
- FoldEvent
- CheckEvent
- StreetAdvanceEvent
- DealEndEvent
- DealInitEvent
- DealCards3rdEvent
- DealCardEvent

---

## 12.3 再接続

- 接続復旧時、現在ゲーム状態を再同期する
- 進行中ハンドがある場合、即座に参加可能

---

# 13. 非機能要件

## 13.1 レイテンシ

- プレイヤー操作反映：1秒以内を目標

## 13.2 同時接続

- 同時卓数：2（固定）
- 1卓最大：6名

## 13.3 可用性

- ゲーム状態はサーバー側で永続化
- サーバー再起動時も進行中ハンドを復元可能

---

# 14. セキュリティ

- クライアントに非公開カード（他者のHole card、未配布カード）を送信しない
- すべてのアクションはサーバー側で検証
- 不正アクション受信時はエラーを返却し、状態変更しない

---

# 15. データ要件

## 15.1 保存対象

- ハンド履歴（全イベントログ）
- ユーザー情報（チップ残高含む）
- 卓参加履歴

## 15.2 ハンド履歴閲覧機能

- 過去にプレイしたハンドを履歴画面から閲覧可能
- 表示内容：
  - ゲーム種別
  - 参加プレイヤー
  - 各Streetのアクション
  - ショーダウン結果
  - 獲得/損失チップ

---

# 16. 運用要件

## 16.1 ログ

- ゲーム進行ログ
- エラーログ
- 接続/切断ログ
- 認証ログ

---

# 17. 将来拡張

## 17.1 HORSE対応

追加対象ゲーム：

- Hold'em（Limit）
- Omaha Hi-Lo（Limit）

### 拡張要件

- GameTypeの追加が容易な設計
- ルールエンジンをゲーム単位で分離
- ホールデムゲーム（コミュニティカード方式）への対応

## 17.2 その他検討項目

- ユーザーによる卓作成機能
- 複数ステークス対応
- ランキング

---

# 18. 技術方針（MVP）

## 推奨構成

```
Client
  React / TypeScript
  WebSocket

Realtime Gateway
  WebSocket Server

Game Server
  State Authority
  Event Engine

Database
  PostgreSQL or similar
  - Game Log
  - User Data
  - Hand History
```

---

# 19. 画面一覧

| 画面名       | 概要                   |
| ------------ | ---------------------- |
| ログイン画面 | Google OAuth認証       |
| ロビー画面   | 卓一覧表示、卓への参加 |
| テーブル画面 | ゲームプレイ           |
| 履歴画面     | 過去のハンド履歴閲覧   |

---

# 20. 未決事項（今後検討）

- プロフィール編集機能 (特にプレイヤー名)