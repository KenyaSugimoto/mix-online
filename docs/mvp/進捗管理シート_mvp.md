# Mix Stud Online 進捗管理シート（MVP）

Version: v1.38  
Last Updated: 2026-02-15  
実装フロー: [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md)  
要件: [`要件定義書_mvp.md`](./要件定義書_mvp.md)  
詳細設計: [`詳細設計書_mvp.md`](./詳細設計書_mvp.md)

---

## 1. 運用ルール

- 更新タイミング:
  - タスク着手時
  - PR作成時
  - マージ完了時
- ステータス定義:
  - `NOT_STARTED`: 未着手
  - `IN_PROGRESS`: 実装中
  - `BLOCKED`: 外部要因で停止
  - `DONE`: DoD達成済み
- 優先度定義:
  - `P0`: MVP成立に必須
  - `P1`: MVP品質向上に必須
  - `P2`: リリース後でも許容

---

## 2. マイルストーン進捗

| Milestone | 内容 | Status | Progress | Owner | Target Date | Notes |
| --- | --- | --- | --- | --- | --- | --- |
| M0 | 品質ゲート固定（lint/check:contract-literals/typecheck/test） | DONE | 100% | Codex | 2026-02-11 | M0-01〜M0-04完了 |
| M1 | DB/マイグレーション運用確立 | DONE | 100% | Codex | 2026-02-11 | M1-01〜M1-04完了 |
| M2 | ロビー/履歴API実装 | DONE | 100% | Codex | 2026-02-11 | M2-01〜M2-06完了 |
| M3 | Realtime + Game Engine成立 | DONE | 100% | Codex | 2026-02-13 | M3-01〜M3-11完了 |
| M4 | Web統合（ロビー〜プレイ） | DONE | 100% | Codex | 2026-02-14 | M4-01〜M4-06完了 |
| M5 | リリース準備完了 | IN_PROGRESS | 85% | Codex | TBA | M5-23でハンド終了後のリビール待機フェーズ（次ハンド開始ディレイ）を実装し、終局直後のカード確認時間を確保した |

---

## 3. 現在の実行ボード

## Now

| ID | Task | Priority | Status | Acceptance Criteria | Link |
| --- | --- | --- | --- | --- | --- |
| M5-00 | M4完了時点のリリース監査（できること/未対応の棚卸し） | P0 | DONE | 監査結果を進捗管理シートと実装推進ガイドへ反映済み | [`進捗管理シート_mvp.md`](./進捗管理シート_mvp.md), [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| M5-10 | 認証の実ユーザー連携（Google code exchange + user永続化） | P0 | DONE | `/api/auth/me` が固定ユーザー以外を返せる | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-11 | Lobby/Table/History のMVP固定データ撤廃（DB Repositoryへ切替） | P0 | DONE | Supabase環境変数設定時に実データ返却、未設定時はMVP fallbackを維持 | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/repository`](../../apps/server/src/repository), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-12 | ローカル統合プレイ確認（HTTP+WS接続経路固定、手動2ユーザー検証） | P0 | IN_PROGRESS | ローカルで2人1ハンド完了を再現し、確認ログを記録できる | [`apps/web/vite.config.ts`](../../apps/web/vite.config.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M5-16 | Realtimeハンド進行成立（StreetAdvance/DealCard/Showdown/DealEnd 実装） | P0 | DONE | `table.act` 後に `toActSeatNo=null` でも遷移継続し、3rd〜終局（UNCONTESTED/SHOWDOWN）まで進行できる | [`apps/server/src/realtime/table-service`](../../apps/server/src/realtime/table-service), [`apps/server/src/__tests__/unit/table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml) |
| M5-17 | `table.act` 契約整合（PokerActionLogic準拠の合法アクション制御） | P0 | DONE | クライアント提示アクションとサーバー受理アクションが一致し、非合法操作をUIで抑止できる | [`apps/server/src/realtime/table-service/act-command.ts`](../../apps/server/src/realtime/table-service/act-command.ts), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`docs/mvp/PokerActionLogic.md`](./PokerActionLogic.md), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml) |
| M5-21 | テーブルアクションUI固定額化（amount入力撤去 + 許可アクションのみボタン表示） | P0 | DONE | Fixed Limit前提で `table.act` は action-only送信となり、局面で許可されたアクションのみボタン表示される | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-18 | TableStore投影強化（DealCard/StreetAdvance/Showdown/DealEnd反映 + console追跡） | P1 | DONE | `table.event` と `table.snapshot` のカード系投影が破綻せず、進行ログ（reason/appliesFrom）を保持できる | [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml) |
| M5-19 | テーブルUI再設計（ゲームテーブル表示、カード可視化、操作導線改善） | P1 | DONE | PR1で契約/Store基盤、PR2で卓UI（レイアウト/カード描画/導線）を実装した | [`docs/mvp/plans/M5-19_table-ui-redesign_plan_2026-02-14.md`](./plans/M5-19_table-ui-redesign_plan_2026-02-14.md), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css) |
| M5-22 | テーブルカード表示UI（配札カード可視化） | P1 | DONE | 3rd〜7thで配札済カードをUIに可視化し、手番追跡を画面上で行える | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-13 | テーブルUIギャップ解消（`reason`/`appliesFrom` 表示、状態不整合検知ログ） | P1 | DONE | `reason`/`appliesFrom` を進行ログに反映し、画面上で遷移理由を追跡できる | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-01 | 構造化ログ/メトリクス/アラート導入（Cloud Logging/Monitoring） | P1 | NOT_STARTED | M5-12 完了 | [`全体アーキテクチャ図_mvp.md`](./全体アーキテクチャ図_mvp.md), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |

## Next

| ID | Task | Priority | Status | Ready条件 | Link |
| --- | --- | --- | --- | --- | --- |
| M5-14 | 表示名変更API追加（`PATCH /api/auth/me/display-name`） | P1 | DONE | M5-10 完了 | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-15 | 表示名変更UI追加（プロフィール編集導線） | P1 | DONE | M5-14 完了 | [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx) |
| M5-02 | 運用Runbook整備（デプロイ手順、ローリング更新、障害復旧） | P1 | NOT_STARTED | M5-01 完了 | [`全体アーキテクチャ図_mvp.md`](./全体アーキテクチャ図_mvp.md) |

## Backlog

| ID | Task | Priority | Status | 受け入れ観点（要約） | Link |
| --- | --- | --- | --- | --- | --- |
| M4-01 | Web認証導線（ログイン開始、callback後初期化、未認証ガード） | P0 | DONE | HP-01 のUI導線成立 | [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`openapi.yaml`](./openapi.yaml) |
| M4-02 | ロビー画面実装（卓一覧表示、参加導線、空席/ゲーム種表示） | P0 | DONE | ロビー仕様表示項目を完全充足 | [`要件定義書_mvp.md`](./要件定義書_mvp.md), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M4-03 | テーブル画面実装（席状態別UI、手番タイマー、アクション入力） | P0 | DONE | 状態別UI制御と操作可否が仕様一致 | [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`状態遷移図_mvp.md`](./状態遷移図_mvp.md) |
| M4-04 | クライアント `TableStore` 実装（`tableSeq` 欠番検知、resume再同期） | P0 | DONE | 欠番検知→resume→再収束の動作確認 | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`asyncapi.yaml`](./asyncapi.yaml) |
| M4-05 | 履歴画面実装（一覧/詳細、ページング、損益表示） | P1 | DONE | HP-08 のUI要件を満たす | [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`openapi.yaml`](./openapi.yaml) |
| M4-06 | E2E導入（HP -> NG -> ED の順でCI組み込み） | P0 | DONE | 主要シナリオを段階導入し回帰検知可能 | [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md), [`.github/workflows/ci.yml`](../../.github/workflows/ci.yml) |
| M5-01 | 構造化ログ/メトリクス/アラート導入（Cloud Logging/Monitoring） | P1 | NOT_STARTED | 監視最小セットと閾値を運用可能化 | [`全体アーキテクチャ図_mvp.md`](./全体アーキテクチャ図_mvp.md), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-02 | 運用Runbook整備（デプロイ手順、ローリング更新、障害復旧） | P1 | NOT_STARTED | 第三者が復旧手順を再現できる | [`全体アーキテクチャ図_mvp.md`](./全体アーキテクチャ図_mvp.md) |
| M5-03 | 非機能検証（レイテンシp95、5xx率、再接続品質） | P1 | NOT_STARTED | 非機能目標の測定結果が取得可能 | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-16 | Realtimeハンド進行成立（StreetAdvance/DealCard/Showdown/DealEnd 実装） | P0 | DONE | 1ハンドが3rd〜終局まで停止せず進み、席/卓/履歴が整合する | [`apps/server/src/realtime/table-service`](../../apps/server/src/realtime/table-service), [`asyncapi.yaml`](./asyncapi.yaml), [`状態遷移図_mvp.md`](./状態遷移図_mvp.md) |
| M5-17 | `table.act` 契約整合（PokerActionLogic準拠の合法アクション制御） | P0 | DONE | UI提示とサーバー受理のアクション差分を解消する | [`apps/server/src/realtime/table-service/act-command.ts`](../../apps/server/src/realtime/table-service/act-command.ts), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`docs/mvp/PokerActionLogic.md`](./PokerActionLogic.md), [`asyncapi.yaml`](./asyncapi.yaml) |
| M5-18 | TableStore投影強化（DealCard/StreetAdvance/Showdown/DealEnd反映 + console追跡） | P1 | DONE | 主要Realtimeイベントで卓状態/手番/進行追跡（console）が破綻しない | [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`asyncapi.yaml`](./asyncapi.yaml) |
| M5-21 | テーブルアクションUI固定額化（amount入力撤去 + 許可アクションのみボタン表示） | P0 | DONE | Fixed Limit前提の操作導線として、許可アクションのみをボタン表示し誤操作を抑止できる | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-22 | テーブルカード表示UI（配札カード可視化） | P1 | DONE | 3rd〜7thで配札済カードをUIに可視化し、手番追跡を画面上で行える | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-19 | テーブルUI再設計（ゲームテーブル表示、カード可視化、操作導線改善） | P1 | DONE | 画面設計書の卓UI要件（座席/カード/操作導線）を満たす | [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css) |
| M5-20 | Realtime契約/E2E強化（HP-04/HP-06/HP-10の自動化） | P1 | NOT_STARTED | 手動検証依存を減らし、進行停止回帰をCIで検知できる | [`apps/server/src/__tests__/e2e`](../../apps/server/src/__tests__/e2e), [`apps/server/src/__tests__/integration/ws-contract.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-contract.integration.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M5-23 | ハンド終了後のリビール待機フェーズ追加（次ハンド開始ディレイ） | P1 | DONE | 7th完了時/途中終局時ともに、`DealEndEvent` 直後はカード表示を保持し、数秒後に次ハンド開始へ遷移する | [`apps/server/src/realtime/table-service/hand.ts`](../../apps/server/src/realtime/table-service/hand.ts), [`apps/server/src/realtime/ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/server/src/__tests__/unit/table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M5-24 | 手番持ち時間表示の同期不具合修正（秒数/バー） | P1 | NOT_STARTED | 現在手番者の残り秒数とバーが実時間で正しく減少し、手番交代時に初期化される | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-25 | 配札ランダム性の不具合修正（スート偏り/固定配札の解消） | P0 | NOT_STARTED | 通常対局で毎回同一カード列にならず、4スートを含むランダム配札が行われる | [`apps/server/src/realtime/table-service/gameplay.ts`](../../apps/server/src/realtime/table-service/gameplay.ts), [`apps/server/src/realtime/table-service/hand.ts`](../../apps/server/src/realtime/table-service/hand.ts), [`apps/server/src/__tests__/unit/table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M5-14 | 表示名変更API追加（`PATCH /api/auth/me/display-name`） | P1 | DONE | ユーザーが任意の表示名へ変更できる | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-15 | 表示名変更UI追加（プロフィール編集導線） | P1 | DONE | 表示名変更を画面から完結できる | [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx) |
| DEC-01 | 未決事項の合意（プレイヤー名変更、最低バイイン、オッドチップ詳細） | P1 | NOT_STARTED | 仕様合意をADR化し関連仕様へ反映 | [`要件定義書_mvp.md`](./要件定義書_mvp.md), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |

## Done

| ID | Task | Priority | Status | Completed At | Link |
| --- | --- | --- | --- | --- | --- |
| M0-01 | `pnpm lint/check:contract-literals/typecheck/test` を全てグリーン化し、失敗時の修正方針を確立 | P0 | DONE | 2026-02-11 | [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| M0-02 | `packages/shared` の共通型を契約準拠で再定義（OpenAPI/AsyncAPI/DDL enum整合） | P0 | DONE | 2026-02-11 | [`openapi.yaml`](./openapi.yaml), [`asyncapi.yaml`](./asyncapi.yaml), [`20260211190000_create_tables.sql`](../../supabase/migrations/20260211190000_create_tables.sql) |
| M0-03 | API/WSの入力バリデーション + 共通エラー応答基盤（`requestId`/`error.code`）を実装 | P0 | DONE | 2026-02-11 | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`openapi.yaml`](./openapi.yaml), [`asyncapi.yaml`](./asyncapi.yaml) |
| M0-04 | テスト基盤整備（unit/integration/e2e、固定デッキハーネス、テストデータ初期化） | P0 | DONE | 2026-02-11 | [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M1-01 | Supabaseマイグレーション雛形作成（`supabase/migrations` 正本化） | P0 | DONE | 2026-02-11 | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`20260211190000_create_tables.sql`](../../supabase/migrations/20260211190000_create_tables.sql) |
| M1-02 | seed投入/ローカル起動/DBリセット手順を確立（`supabase start` 前提） | P0 | DONE | 2026-02-11 | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`README.md`](../../supabase/migrations/README.md), [`20260211190200_seed_initial_data.sql`](../../supabase/migrations/20260211190200_seed_initial_data.sql) |
| M1-03 | Repository層とトランザクション境界を定義（`hand_events` 正史、配信先行禁止） | P0 | DONE | 2026-02-11 | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`apps/server/src/repository/command/contract.ts`](../../apps/server/src/repository/command/contract.ts), [`apps/server/src/repository/command/persist-command.ts`](../../apps/server/src/repository/command/persist-command.ts) |
| M1-04 | 主要テーブルCRUDテスト（users/wallets/tables/table_seats/hands/hand_events） | P0 | DONE | 2026-02-11 | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`20260211190000_create_tables.sql`](../../supabase/migrations/20260211190000_create_tables.sql), [`db-schema.integration.test.ts`](../../apps/server/src/__tests__/integration/db-schema.integration.test.ts) |
| M2-01 | `/api/lobby/tables` を OpenAPI準拠で本実装化（仮実装除去） | P0 | DONE | 2026-02-11 | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts), [`m0-04-foundation.e2e.test.ts`](../../apps/server/src/__tests__/e2e/m0-04-foundation.e2e.test.ts) |
| M2-02 | `/api/tables/:tableId` を OpenAPI準拠で実装（席状態・進行中ハンド要約含む） | P0 | DONE | 2026-02-11 | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`table-detail.ts`](../../apps/server/src/table-detail.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| M2-03 | 認証API基盤（Google callback後のCookie session、`/api/auth/me`、`/api/auth/logout`）を実装 | P0 | DONE | 2026-02-11 | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`auth-session.ts`](../../apps/server/src/auth-session.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| M2-04 | `/api/history/hands` 実装（cursor署名、`endedAt DESC, handId DESC`） | P0 | DONE | 2026-02-11 | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`history-cursor.ts`](../../apps/server/src/history-cursor.ts), [`history-repository.ts`](../../apps/server/src/repository/history/contract.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| M2-05 | `/api/history/hands/:handId` 実装（streetActions/showdown/profitLoss） | P0 | DONE | 2026-02-11 | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`history-hand.ts`](../../apps/server/src/history-hand.ts), [`history-repository.ts`](../../apps/server/src/repository/history/contract.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| M2-06 | HTTP契約テスト（OpenAPI準拠チェック、自動化） | P0 | DONE | 2026-02-11 | [`openapi.yaml`](./openapi.yaml), [`http-contract.integration.test.ts`](../../apps/server/src/__tests__/integration/http-contract.integration.test.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M3-01 | WebSocketゲートウェイ実装（`/ws`、コマンド検証、`table.error`） | P0 | DONE | 2026-02-11 | [`asyncapi.yaml`](./asyncapi.yaml), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`server.ts`](../../apps/server/src/realtime/server.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts) |
| M3-02 | Table Actor基盤（卓単位直列処理、`tableSeq/handSeq` 採番） | P0 | DONE | 2026-02-11 | [`table-actor.ts`](../../apps/server/src/realtime/table-actor.ts), [`table-actor.unit.test.ts`](../../apps/server/src/__tests__/unit/table-actor.unit.test.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M3-03 | 席管理コマンド（join/sitOut/return/leave）と状態遷移実装 | P0 | DONE | 2026-02-11 | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts) |
| M3-04 | ハンド開始〜3rd配札基盤（DealInit/PostAnte/DealCards3rd + bring-in席確定） | P0 | DONE | 2026-02-11 | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`fixed-deck-harness.ts`](../../apps/server/src/testing/fixed-deck-harness.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M3-05 | アクション合法性実装（手番、toCall、5bet cap全卓適用） | P0 | DONE | 2026-02-12 | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M3-06 | `GameRule` 実装（StudHi/Razz/Stud8 Bring-in/先手判定） | P0 | DONE | 2026-02-11 | [`game-rule.ts`](../../apps/server/src/realtime/game-rule.ts), [`game-rule.unit.test.ts`](../../apps/server/src/__tests__/unit/game-rule.unit.test.ts), [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M3-07 | Showdown評価・Hi/Lo分配・サイドポット・オッドチップ実装 | P0 | DONE | 2026-02-11 | [`showdown-evaluator.ts`](../../apps/server/src/realtime/showdown-evaluator.ts), [`showdown-evaluator.unit.test.ts`](../../apps/server/src/__tests__/unit/showdown-evaluator.unit.test.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M3-08 | タイムアウト/切断処理（AutoAction、disconnect streak>=3で自動LEAVE） | P0 | DONE | 2026-02-11 | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M3-09 | 再接続復元（`table.resume` 差分再送 + `table.snapshot` フォールバック） | P0 | DONE | 2026-02-11 | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts), [`asyncapi.yaml`](./asyncapi.yaml) |
| M3-10 | サーバー再起動復元（`IN_PROGRESS` リプレイ、タイマー再設定） | P0 | DONE | 2026-02-11 | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`table-actor.ts`](../../apps/server/src/realtime/table-actor.ts), [`server.ts`](../../apps/server/src/realtime/server.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts) |
| M3-11 | Realtime契約テスト（AsyncAPI準拠のイベント/エラー/snapshot） | P0 | DONE | 2026-02-13 | [`ws-contract.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-contract.integration.test.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts), [`asyncapi.yaml`](./asyncapi.yaml) |
| M4-01 | Web認証導線（ログイン開始、callback後初期化、未認証ガード） | P0 | DONE | 2026-02-13 | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/auth-api.ts`](../../apps/web/src/auth-api.ts), [`apps/web/src/routes.ts`](../../apps/web/src/routes.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M4-02 | ロビー画面実装（卓一覧表示、参加導線、空席/ゲーム種表示） | P0 | DONE | 2026-02-13 | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/lobby-api.ts`](../../apps/web/src/lobby-api.ts), [`apps/web/src/lobby-api.test.ts`](../../apps/web/src/lobby-api.test.ts), [`要件定義書_mvp.md`](./要件定義書_mvp.md) |
| M4-03 | テーブル画面実装（席状態別UI、手番タイマー、アクション入力） | P0 | DONE | 2026-02-14 | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-api.ts`](../../apps/web/src/table-api.ts), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`状態遷移図_mvp.md`](./状態遷移図_mvp.md) |
| M4-04 | クライアント `TableStore` 実装（`tableSeq` 欠番検知、resume再同期） | P0 | DONE | 2026-02-13 | [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`asyncapi.yaml`](./asyncapi.yaml) |
| M4-05 | 履歴画面実装（一覧/詳細、ページング、損益表示） | P1 | DONE | 2026-02-14 | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/routes.ts`](../../apps/web/src/routes.ts), [`apps/web/src/history-api.ts`](../../apps/web/src/history-api.ts), [`apps/web/src/history-api.test.ts`](../../apps/web/src/history-api.test.ts), [`apps/web/src/history-screen.tsx`](../../apps/web/src/history-screen.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`openapi.yaml`](./openapi.yaml) |
| M4-06 | E2E導入（HP -> NG -> ED の順でCI組み込み） | P0 | DONE | 2026-02-14 | [`.github/workflows/ci.yml`](../../.github/workflows/ci.yml), [`apps/server/src/__tests__/e2e/hp.e2e.test.ts`](../../apps/server/src/__tests__/e2e/hp.e2e.test.ts), [`apps/server/src/__tests__/e2e/ng.e2e.test.ts`](../../apps/server/src/__tests__/e2e/ng.e2e.test.ts), [`apps/server/src/__tests__/e2e/ed.e2e.test.ts`](../../apps/server/src/__tests__/e2e/ed.e2e.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M5-10 | 認証の実ユーザー連携（Google code exchange + user永続化） | P0 | DONE | 2026-02-14 | [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`apps/server/src/google-oauth-client.ts`](../../apps/server/src/google-oauth-client.ts), [`apps/server/src/repository/auth/index.ts`](../../apps/server/src/repository/auth/index.ts), [`apps/server/src/__tests__/integration/http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-11 | Lobby/Table/History のMVP固定データ撤廃（DB Repositoryへ切替） | P0 | DONE | 2026-02-14 | [`apps/server/src/repository/lobby/supabase.ts`](../../apps/server/src/repository/lobby/supabase.ts), [`apps/server/src/repository/table-detail/supabase.ts`](../../apps/server/src/repository/table-detail/supabase.ts), [`apps/server/src/repository/history/supabase.ts`](../../apps/server/src/repository/history/supabase.ts), [`apps/server/src/realtime/server.ts`](../../apps/server/src/realtime/server.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-16 | Realtimeハンド進行成立（StreetAdvance/DealCard/Showdown/DealEnd 実装） | P0 | DONE | 2026-02-14 | [`apps/server/src/realtime/table-service/hand.ts`](../../apps/server/src/realtime/table-service/hand.ts), [`apps/server/src/realtime/table-service/act-command.ts`](../../apps/server/src/realtime/table-service/act-command.ts), [`apps/server/src/__tests__/unit/table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`packages/shared/src/index.ts`](../../packages/shared/src/index.ts) |
| M5-17 | `table.act` 契約整合（PokerActionLogic準拠の合法アクション制御） | P0 | DONE | 2026-02-14 | [`apps/server/src/realtime/table-service/act-command.ts`](../../apps/server/src/realtime/table-service/act-command.ts), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`docs/mvp/PokerActionLogic.md`](./PokerActionLogic.md), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml) |
| M5-18 | TableStore投影強化（DealCard/StreetAdvance/Showdown/DealEnd反映 + console追跡） | P1 | DONE | 2026-02-14 | [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml) |
| M5-21 | テーブルアクションUI固定額化（amount入力撤去 + 許可アクションのみボタン表示） | P0 | DONE | 2026-02-14 | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-22 | テーブルカード表示UI（配札カード可視化） | P1 | DONE | 2026-02-14 | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-23 | ハンド終了後のリビール待機フェーズ追加（次ハンド開始ディレイ） | P1 | DONE | 2026-02-15 | [`apps/server/src/realtime/table-service/hand.ts`](../../apps/server/src/realtime/table-service/hand.ts), [`apps/server/src/realtime/table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`apps/server/src/realtime/ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/server/src/__tests__/unit/table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| M5-13 | テーブルUIギャップ解消（`reason`/`appliesFrom` 表示、状態不整合検知ログ） | P1 | DONE | 2026-02-14 | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-19 | テーブルUI再設計（ゲームテーブル表示、カード可視化、操作導線改善） | P1 | DONE | 2026-02-14 | [`docs/mvp/plans/M5-19_table-ui-redesign_plan_2026-02-14.md`](./plans/M5-19_table-ui-redesign_plan_2026-02-14.md), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| M5-14 | 表示名変更API追加（`PATCH /api/auth/me/display-name`） | P1 | DONE | 2026-02-14 | [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`apps/server/src/repository/auth/contract.ts`](../../apps/server/src/repository/auth/contract.ts), [`apps/server/src/repository/auth/in-memory.ts`](../../apps/server/src/repository/auth/in-memory.ts), [`apps/server/src/repository/auth/supabase.ts`](../../apps/server/src/repository/auth/supabase.ts), [`apps/server/src/__tests__/integration/http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts), [`docs/mvp/openapi.yaml`](./openapi.yaml), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| M5-15 | 表示名変更UI追加（プロフィール編集導線） | P1 | DONE | 2026-02-14 | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/auth-api.ts`](../../apps/web/src/auth-api.ts), [`apps/web/src/auth-api.test.ts`](../../apps/web/src/auth-api.test.ts), [`apps/web/src/web-constants.ts`](../../apps/web/src/web-constants.ts), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |

## Blocked

| ID | Task | Priority | Blocking Reason | Next Action | Owner |
| --- | --- | --- | --- | --- | --- |
| - | - | - | 現在、BLOCKEDタスクなし | - | - |

## M4完了時点の機能棚卸し（2026-02-14）

| 領域 | できること（確認済み） | まだできないこと / 制約 | リリース判定 |
| --- | --- | --- | --- |
| 認証 | `/api/auth/google/start` / callback / `/api/auth/me` / `/api/auth/logout` の導線は成立し、callbackでGoogle code exchange後に実ユーザーをセッション化できる。初期表示名は匿名ID（`Player-XXXXXX`）で採番し、再ログインで上書きしない。さらに `PATCH /api/auth/me/display-name` とロビー画面の表示名編集導線（`M5-15`）を実装済み | `SUPABASE_URL` / `SUPABASE_SERVICE_ROLE_KEY` 未設定時は in-memory fallback（再起動で消える） | P0主要対応完了 |
| Lobby/Table/History API | OpenAPI準拠のエンドポイントとWeb画面連携は成立。Supabase環境変数設定時はRepository経由で実データを返却できる | Realtimeの永続化は未接続のため、実プレイ後の履歴反映は `M5-12` で再確認が必要 | P0主要対応完了 |
| Realtimeプレイ | `/ws` 接続、着席、3rd開始に加え、`StreetAdvance/DealCard/Showdown/DealEnd` で終局まで進行でき、`table.act` の受理アクションとUI提示候補を一致させた。さらに viewer別カードマスク（`DOWN_SELF`/`DOWN_HIDDEN`）と `table.snapshot` のカード復元情報を配信できる | 履歴永続化との完全整合・E2E拡張（`M5-20`）は未完 | P0主要対応完了 |
| ゲーム画面UI | 席状態ごとの操作可否、手番タイマー、卓メタ情報、6席フェルトレイアウト、配札カード可視化（viewer別秘匿）、固定額アクションドック、進行ログ（`reason`/`appliesFrom`）を実装済み | 2ユーザー手動統合プレイ（M5-12）による最終確認は未実施 | P0主要対応完了 |
| 運用/リリース準備 | 品質ゲート（lint/contract-literals/typecheck/test）とCIの段階E2Eは稼働 | 監視・Runbook・非機能検証が未着手 | P1対応が必要 |

---

## 4. リスクログ

| Date | Risk | Impact | Mitigation | Status |
| --- | --- | --- | --- | --- |
| 2026-02-14 | 手番進行が `toActSeatNo=null` で停止し、卓が `BETTING` から終局へ遷移しない | 高 | `M5-16` で StreetAdvance/DealCard/Showdown/DealEnd と次ハンド開始判定を実装し、unitテストで回帰検知を追加 | CLOSED |
| 2026-02-14 | `table.act` の契約値とサーバー実装が不一致で、UIに非合法アクションが表示される | 高 | `M5-17` で `PokerActionLogic.md` 準拠の局面別合法アクション判定（server/UI）へ統一し、`BET` / `BRING_IN` を局面制約付きで受理 | CLOSED |
| 2026-02-14 | Realtime契約/E2Eが全イベント系（DealCard/StreetAdvance/Showdown/DealEnd）を検証できておらず、回帰を見逃す | 高 | `M5-20` で契約テストとHPシナリオを拡張し、停止系不具合をCIで検知 | OPEN |
| 2026-02-14 | OAuth callbackが固定ユーザーを発行しており、実ユーザー識別ができない | 高 | `M5-10` で code exchange + user永続化 + セッション統合テストを実施 | CLOSED |
| 2026-02-14 | 表示名変更のUI導線が未実装のため、API実装後も画面から直接変更できない | 中 | `M5-15`（UI）でプロフィール編集導線を追加した | CLOSED |
| 2026-02-14 | Lobby/Table/History がMVP固定データ依存で本番データ経路を検証できない | 高 | `M5-11` でSupabase Repositoryへ切替。環境変数未設定時のみMVP fallbackを許容 | CLOSED |
| 2026-02-14 | Webクライアントの `/ws` 接続経路がローカル起動構成と不整合になる可能性 | 中 | `M5-12` でVite proxyに `/ws` を追加して経路を固定。残件は2ユーザー手動試験の記録化 | IN_PROGRESS |
| 2026-02-14 | 画面設計書のUIログ要件（`reason`/`appliesFrom`保持）が未充足 | 中 | `M5-13` でUI反映 + 画面仕様テストケースを追加 | CLOSED |
| 2026-02-11 | テーブル進行ロジックの複雑化で回帰が起きやすい | 高 | GameRule単体テストを先行整備 | OPEN |

---

## 5. 意思決定ログ（簡易ADR）

| Date | Topic | Decision | Reason | Related Docs |
| --- | --- | --- | --- | --- |
| 2026-02-15 | M5-23 リビール待機フェーズ導入方針 | `DealEndEvent` 後は即 `DealInitEvent` を出さず `HAND_END` を維持し、サーバータイマー満了時に `SEATED_WAIT_NEXT_HAND` 活性化と次ハンド開始判定を実行する。クライアントは `DealEndEvent` でカードをクリアせず、待機中も最終盤面を表示し続ける。 | 終局直後に結果確認する時間を確保しつつ、途中参加席の `NEXT_HAND_ACTIVATE` タイミングを「次ハンド開始時」に維持するため | [`apps/server/src/realtime/table-service/hand.ts`](../../apps/server/src/realtime/table-service/hand.ts), [`apps/server/src/realtime/table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`apps/server/src/realtime/ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| 2026-02-14 | M5-15 表示名編集UI方針 | ロビーに表示名編集フォーム（編集モード切替/保存中disable/成功・失敗メッセージ表示）を追加し、`PATCH /api/auth/me/display-name` の結果で `authState` を即時更新する。 | API実装（M5-14）後にユーザーが画面から完結して表示名を変更できる導線を確立し、次画面遷移を待たず表示を同期させるため | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/auth-api.ts`](../../apps/web/src/auth-api.ts), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| 2026-02-14 | M5-14 表示名変更APIの入力制約 | `PATCH /api/auth/me/display-name` は `displayName` を trim 後 1〜64文字で受理し、認証ユーザーの `users.display_name` を更新して `user` を返す。失敗時は `BAD_REQUEST` / `AUTH_EXPIRED` を返す。 | OpenAPI `UserProfile.displayName` の制約（1〜64）と整合させつつ、空白のみ入力や不正payloadを早期に拒否してUI実装（M5-15）と契約を固定するため | [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`apps/server/src/repository/auth/contract.ts`](../../apps/server/src/repository/auth/contract.ts), [`docs/mvp/openapi.yaml`](./openapi.yaml), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-14 | M5-19 追加UI調整（カード段差の有効化 + 枠視認性改善） | 表向きカードの段差表現を `margin-top` から `position/top` ベースへ切替え、確実に上方向へオフセットされるよう修正。カード境界の判読性向上のため、表カードの枠色/背景/内側シャドウと裏カード枠色を調整した。 | 実機確認で「段差が視認できない」「境界が曖昧」という課題が残ったため、レイアウト実装を安定化して読み取りやすさを優先するため | [`apps/web/src/app.css`](../../apps/web/src/app.css), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| 2026-02-14 | M5-19 追加UI調整（カード重なり + 席別直近アクション） | 7枚カードを1列横並びかつ重なり表示へ変更し、表向きカードは上方向オフセットを維持。直近アクション表示はアクションドックから撤去し、各席パネル付近へ移設した。Storeは単一 `lastAction` から `lastActionBySeatNo` に拡張して席ごとの最新アクションを保持する。 | 各席のカード構成と行動履歴を即座に判別できるようにし、操作ドックの情報密度を下げてプレイ中の視認性を高めるため | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| 2026-02-14 | M5-19 追加UI調整（視認性・操作性の最終磨き込み） | アクションボタンを横1行ドックへ最適化し、手番強調は `is-you` ではなく `toActSeat` のみを強調。Main Potはポット額＋Streetに限定し、直近アクション表示を追加。さらに表向きカード（`UP_3`〜`UP_6`）を上方向にオフセットして伏せ札との差を視覚化した。加えて、未対応課題として `M5-23/24/25` を起票した。 | 実プレイ時の可読性と操作ミス防止を優先し、手番把握・アクション把握・カード視認性を最短で改善するため | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| 2026-02-14 | M5-19 PR2 フィードバック反映（UI磨き込み） | テーブル表示時はアプリ共通ヘッダーを非表示化し、卓内UIを「中央Main Pot + 周囲6席 + 右上折りたたみログ + 下部アクションドック」に再配置。未着席時は席ごとボタンではなく buy-in 指定モーダル経由で `table.join` を送信する。あわせて `StreetAdvance` 受信時に `streetBetTo/raiseCount` をリセットし、4th以降 no-bet で `CHECK/BET` を表示できるようにした。 | プレイ中の視認性/操作性を高め、契約上 seatNo 指定不可の着席導線と PokerActionLogic の no-bet 分岐をUI上で一致させるため | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| 2026-02-14 | M5-19 PR2（卓UI本体） | `table-screen` を6席フェルトレイアウトへ刷新し、`cardsBySeatNo` をカード描画、`eventLogs` を進行ログ表示へ接続した。`table.act` は許可アクションのみボタン表示するドックUIへ統一 | PR1で固定した契約/Store基盤をUIに接続し、プレイ時に座席/カード/手番/理由ログを1画面で追跡できる状態を成立させるため | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/app.css`](../../apps/web/src/app.css), [`画面設計書_mvp.md`](./画面設計書_mvp.md) |
| 2026-02-14 | M5-19 PR1（契約/Store基盤） | テーブルUI再設計を2段階化し、PR1で shared/AsyncAPI/サーバーマスク配信/TableStore投影（cards + eventLogs）を先行実装する | UI刷新（PR2）の前に、再接続復元と秘匿情報配信の契約を固定し、見た目変更と状態管理変更を分離して回帰影響を局所化するため | [`docs/mvp/plans/M5-19_table-ui-redesign_plan_2026-02-14.md`](./plans/M5-19_table-ui-redesign_plan_2026-02-14.md), [`packages/shared/src/index.ts`](../../packages/shared/src/index.ts), [`apps/server/src/realtime/ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-14 | M5-17 `table.act` 契約整合方針（更新） | `PokerActionLogic.md` を正本として `table.act` の合法アクションを局面別に固定する。`BET` は4th以降 no-bet 局面で受理し、`BRING_IN` は3rd未アクション局面（bring-in席の手番）で受理する | ゲーム進行として自然な選択肢を担保しつつ、UI提示集合とサーバー受理集合を一致させるため | [`docs/mvp/PokerActionLogic.md`](./PokerActionLogic.md), [`apps/server/src/realtime/table-service/act-command.ts`](../../apps/server/src/realtime/table-service/act-command.ts), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml) |
| 2026-02-14 | M5-21/M5-22 UIスコープ分割 | カード可視化UIは `M5-22` として次タスクへ分離し、現タスクは `M5-21`（fixed-limit前提の amount入力撤去・許可アクションのみボタン表示）と `M5-18` の最小追跡（DealCard系をconsole出力）に絞る | 1PR内の変更範囲を制御し、プレイ導線の不整合修正を優先しつつカード描画は独立検証可能な単位に分離するため | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| 2026-02-14 | M5-16 Realtime進行遷移の実装方針 | `table.act` 後に `toActSeatNo=null` となった場合、`StreetAdvance` を起点に `DealCard`（4th-7th）・`Showdown`・`DealEnd` を連結し、`SEATED_WAIT_NEXT_HAND` 活性化と次ハンド開始判定まで同一トランザクション内で処理する | 手動プレイで顕在化した進行停止を解消し、`M5-12` の再検証前提をコード上で固定するため | [`apps/server/src/realtime/table-service/hand.ts`](../../apps/server/src/realtime/table-service/hand.ts), [`apps/server/src/realtime/table-service/act-command.ts`](../../apps/server/src/realtime/table-service/act-command.ts), [`apps/server/src/__tests__/unit/table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`docs/mvp/asyncapi.yaml`](./asyncapi.yaml) |
| 2026-02-14 | M5-12スコープ再定義（実装前のギャップ棚卸し） | 進行停止不具合を受け、`M5-12` は一旦 `BLOCKED` とし、先に `M5-16/17/18/20` でプレイ成立の実装ギャップを解消してから手動2ユーザー検証を再開する | 手動検証だけ先行しても「プレイ不能状態」を繰り返すため、実装優先順位を再整理して品質を担保する必要があるため | [`進捗管理シート_mvp.md`](./進捗管理シート_mvp.md), [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md), [`apps/server/src/realtime/table-service`](../../apps/server/src/realtime/table-service), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts) |
| 2026-02-14 | M5-12 ローカル接続経路固定方針 | Web開発サーバー（Vite）で `/api` に加えて `/ws` を `http://localhost:3000` へproxyし、`TableStore` は `VITE_WS_URL` 未設定時に同一Origin `/ws` を使う | ローカル起動時のHTTP/WS経路差分をなくし、2ユーザー手動検証で再現可能な接続条件を固定するため | [`apps/web/vite.config.ts`](../../apps/web/vite.config.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-14 | M5-11 API実データ化方針 | `startRealtimeServer` で Supabase 環境変数を検出した場合に `Lobby/Table/History` のRepositoryを Supabase 実装へ注入し、未設定時は既存MVP fallbackを維持する | ローカル検証・既存テストの互換を保ちながら、本番相当の実データ経路へ段階移行するため | [`apps/server/src/realtime/server.ts`](../../apps/server/src/realtime/server.ts), [`apps/server/src/repository/lobby/supabase.ts`](../../apps/server/src/repository/lobby/supabase.ts), [`apps/server/src/repository/table-detail/supabase.ts`](../../apps/server/src/repository/table-detail/supabase.ts), [`apps/server/src/repository/history/supabase.ts`](../../apps/server/src/repository/history/supabase.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-14 | Colima向けSupabase起動手順の更新（LOCAL-DB-START-01） | `pnpm db:start` は Colima 失敗時に `edge-runtime/logflare/vector` 除外構成を先に試し、最終的にDB-onlyへフォールバックする。認証/REST確認用に `pnpm db:start:api` を追加 | OAuth連携やSupabase REST検証に必要な `SERVICE_ROLE_KEY` をローカルで取得しやすくし、DB-only前提との使い分けを明確化するため | [`scripts/db-start.sh`](../../scripts/db-start.sh), [`scripts/db-start-api.sh`](../../scripts/db-start-api.sh), [`package.json`](../../package.json), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`README.md`](../../supabase/migrations/README.md) |
| 2026-02-14 | 認証表示名の初期値・更新方針（M5-10追補） | 初回ログイン時の `display_name` は Google `name` を使わず匿名ID（`Player-XXXXXX`）を採番し、同一 `google_sub` 再ログイン時は上書きしない。表示名変更機能は `M5-14`（API）と `M5-15`（UI）に分離 | 本名表示を避けるプライバシー要件を満たしつつ、表示名変更機能を段階的に導入するため | [`apps/server/src/repository/auth/index.ts`](../../apps/server/src/repository/auth/index.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`進捗管理シート_mvp.md`](./進捗管理シート_mvp.md) |
| 2026-02-14 | M5-10 認証実運用化方針 | callbackで固定ユーザー発行を廃止し、Google code exchange結果（`sub`/`name`）を `users`/`wallets` へ永続化したユーザーをセッション化する。Supabase未設定時はin-memory fallbackを使用 | リリース阻害P0だった「固定ユーザー依存」を解消し、`/api/auth/me` を実ユーザー基準へ移行するため | [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`apps/server/src/google-oauth-client.ts`](../../apps/server/src/google-oauth-client.ts), [`apps/server/src/repository/auth/index.ts`](../../apps/server/src/repository/auth/index.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-14 | M5着手順（旧方針、当日中に置換済み） | 当初は `M5-10(認証実運用化) -> M5-11(実データ化) -> M5-12(ローカル統合プレイ確認)` をP0先行としたが、同日決定の「M5-12スコープ再定義」により `M5-16 -> M5-17 -> M5-18 -> M5-12` へ置換した | 手動検証で進行停止が顕在化し、進行遷移と契約整合を先に実装しない限りプレイ成立判定ができないため | [`進捗管理シート_mvp.md`](./進捗管理シート_mvp.md), [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`apps/web/vite.config.ts`](../../apps/web/vite.config.ts), [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts) |
| 2026-02-14 | M4-06 E2E段階導入のCI組み込み方針 | E2Eを `foundation -> HP -> NG -> ED` の順にテストファイル分割し、CIジョブを段階実行へ更新する方針を採用 | 回帰検知を維持しながら、失敗時にカテゴリ単位で原因を切り分けやすくするため | [`.github/workflows/ci.yml`](../../.github/workflows/ci.yml), [`apps/server/src/__tests__/e2e/hp.e2e.test.ts`](../../apps/server/src/__tests__/e2e/hp.e2e.test.ts), [`apps/server/src/__tests__/e2e/ng.e2e.test.ts`](../../apps/server/src/__tests__/e2e/ng.e2e.test.ts), [`apps/server/src/__tests__/e2e/ed.e2e.test.ts`](../../apps/server/src/__tests__/e2e/ed.e2e.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| 2026-02-13 | M4-04 TableStore同期方式 | `TableStore` を導入し、`tableSeq` 連番管理・欠番検知時の `table.resume(lastTableSeq)`・`table.snapshot` 反映による再収束をクライアント側で実装する方針を採用 | Cloud Run接続断・一時的な受信欠落があっても、AsyncAPI契約に沿って最終整合へ収束させるため | [`apps/web/src/table-store.ts`](../../apps/web/src/table-store.ts), [`apps/web/src/table-store.test.ts`](../../apps/web/src/table-store.test.ts), [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`asyncapi.yaml`](./asyncapi.yaml) |
| 2026-02-14 | M4-03 テーブル画面の状態別UI制御方針 | `/api/tables/:tableId` の取得結果をもとに、自席 `SeatStatus` ごとに `table.act` 入力可否と `JOIN/SIT_OUT/RETURN/LEAVE` の操作可否を切り替えるUIを実装し、手番タイマー（`actionDeadlineAt`）を表示する方針を採用 | 画面設計書で定義された表示制御（`SEATED_WAIT_NEXT_HAND` / `ACTIVE` / `SIT_OUT` / `LEAVE_PENDING` / `DISCONNECTED`）を、M4-04 の WebSocket 同期実装前にフロント単体で担保するため | [`apps/web/src/table-screen.tsx`](../../apps/web/src/table-screen.tsx), [`apps/web/src/table-api.ts`](../../apps/web/src/table-api.ts), [`apps/web/src/table-control.ts`](../../apps/web/src/table-control.ts), [`画面設計書_mvp.md`](./画面設計書_mvp.md), [`状態遷移図_mvp.md`](./状態遷移図_mvp.md) |
| 2026-02-14 | M4-05 履歴画面の一覧/詳細統合方針 | `GET /api/history/hands` と `GET /api/history/hands/:handId` を同一画面で統合し、一覧選択で詳細を切替、`nextCursor` で追記ページングするUI方針を採用 | HP-08 の「一覧/詳細/損益表示」を1画面で満たしつつ、履歴詳細の再読込やページ追加を局所的に再試行できる構成にするため | [`apps/web/src/history-api.ts`](../../apps/web/src/history-api.ts), [`apps/web/src/history-screen.tsx`](../../apps/web/src/history-screen.tsx), [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`openapi.yaml`](./openapi.yaml) |
| 2026-02-14 | ローカル環境変数の自動読込（LOCAL-AUTH-03） | `apps/server` 起動時に `.env.local` → `.env` を自動読込し、既存環境変数の上書きを禁止する実装に変更 | OAuth設定の `export` 手作業を省きつつ、CIや本番の明示設定値を意図せず書き換えないため | [`env-loader.ts`](../../apps/server/src/env-loader.ts), [`index.ts`](../../apps/server/src/index.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-14 | OAuth callback遷移先の環境差分吸収（LOCAL-AUTH-02） | callback後リダイレクト先を `WEB_CLIENT_ORIGIN` で構成可能にし、ローカル既定を `http://localhost:5173/lobby` に統一した | APIサーバー相対パス `/lobby` へ遷移して `NOT_FOUND` になる誤配線を防ぐため | [`app.ts`](../../apps/server/src/app.ts), [`server.ts`](../../apps/server/src/realtime/server.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-13 | Google OAuth `invalid_client` 再発防止（LOCAL-AUTH-01） | `GOOGLE_OAUTH_CLIENT_ID` を必須設定にし、未設定時は `GET /api/auth/google/start` で即時エラーを返す運用に変更 | Google Console未設定のままOAuth開始して `401 invalid_client` になる曖昧な失敗を、設定漏れとして早期に検知するため | [`app.ts`](../../apps/server/src/app.ts), [`server.ts`](../../apps/server/src/realtime/server.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-11 | 実装推進方式 | AIエージェント委譲 + DoD厳格運用 | 速度より品質を優先するため | [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| 2026-02-11 | 品質ゲート運用（M0-01） | `pnpm lint` → `pnpm check:contract-literals` → `pnpm typecheck` → `pnpm test` の固定順と一次切り分け手順を採用 | 失敗時の調査順序を固定し、復旧時間のばらつきを減らすため | [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| 2026-02-11 | 共通型契約同期（M0-02） | `packages/shared` で契約由来enumを定数化し、契約整合テストを導入 | OpenAPI/AsyncAPI/DDLとの差分を早期検知し、下流実装の型逸脱を防ぐため | [`openapi.yaml`](./openapi.yaml), [`asyncapi.yaml`](./asyncapi.yaml), [`20260211190000_create_tables.sql`](../../supabase/migrations/20260211190000_create_tables.sql) |
| 2026-02-11 | テスト基盤整備（M0-04） | server テストを unit/integration/e2e 層へ分割し、固定デッキ・テストデータ初期化・シナリオID固定を導入 | シナリオ実装前に土台を固定して、後続タスクの追加コストと回帰リスクを下げるため | [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| 2026-02-11 | 入力検証/共通エラー基盤完了（M0-03） | HTTP requestId付与・共通error.code応答・WSコマンド基本検証・requestId重複検知基盤を確定 | M1以降でAPI/WS実装を進める際のエラー仕様ドリフトを防ぐため | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`openapi.yaml`](./openapi.yaml), [`asyncapi.yaml`](./asyncapi.yaml) |
| 2026-02-11 | DBローカル運用手順の固定（M1-02） | `supabase start` 前提で `pnpm db:start/db:reset/db:status/db:stop` を標準手順として採用し、seed適用確認SQLと期待値を文書化 | 開発者ごとの差異を減らし、マイグレーション再現性と初期データ検証のばらつきを防ぐため | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`README.md`](../../supabase/migrations/README.md) |
| 2026-02-11 | Colima向け`db:start`フォールバック導入 | `pnpm db:start` で通常起動失敗時に DB 最小構成へ自動フォールバックする運用を採用 | Colima環境でも起動手順を共通化し、M1以降のDB検証を安定化するため | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`README.md`](../../supabase/migrations/README.md) |
| 2026-02-11 | Repository境界定義（M1-03） | `apps/server/src/repository` に CommandRepository契約と `persistCommandAndPublish` を導入し、1コマンド=1TX + コミット後配信を実装基準化 | `hand_events` を正史とする整合性前提をコード境界として先行固定し、配信先行による順序破綻を防ぐため | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`apps/server/src/repository/command/contract.ts`](../../apps/server/src/repository/command/contract.ts), [`apps/server/src/repository/command/persist-command.ts`](../../apps/server/src/repository/command/persist-command.ts) |
| 2026-02-11 | 主要テーブルCRUD検証方針（M1-04） | Docker上のローカルPostgreSQLに対する統合テストで、users/wallets/tables/table_seats/hands/hand_events のCRUDと制約（FK/UNIQUE/CHECK）を実行検証する方針を採用 | DDL記述のみの確認ではなく実行時制約まで担保し、M2以降のRepository/API実装の土台品質を固定するため | [`詳細設計書_mvp.md`](./詳細設計書_mvp.md), [`20260211190000_create_tables.sql`](../../supabase/migrations/20260211190000_create_tables.sql), [`db-schema.integration.test.ts`](../../apps/server/src/__tests__/integration/db-schema.integration.test.ts) |
| 2026-02-11 | PR本文テンプレート改善（LOCAL-PR-TEMPLATE-01） | Before/After、Impact詳細、Risks/Rollback欄を追加したテンプレートに更新 | レビュワーが「何がどう変わるか」を短時間で判断できるようにするため | [`pull_request_template.md`](../../.github/pull_request_template.md) |
| 2026-02-11 | APIリファレンス閲覧改善（LOCAL-DOCS-RENDER-01） | OpenAPIはHTML自動生成、AsyncAPIはPages上の参照導線を提供する運用を採用 | GitHubブラウザで契約仕様を確認しやすくし、手動PDF更新を不要にするため | [`APIリファレンス閲覧ガイド_mvp.md`](./APIリファレンス閲覧ガイド_mvp.md), [`docs-pages.yml`](../../.github/workflows/docs-pages.yml) |
| 2026-02-11 | Pages自動有効化 + AsyncAPI HTML化（LOCAL-DOCS-RENDER-02） | `configure-pages` に `enablement: true` を追加し、AsyncAPIを Web Component でHTML表示する運用へ更新 | Pages未初期化時の404失敗を防ぎ、OpenAPI/AsyncAPIの閲覧導線を同一UXで提供するため | [`docs-pages.yml`](../../.github/workflows/docs-pages.yml), [`build-api-reference-site.sh`](../../scripts/build-api-reference-site.sh), [`APIリファレンス閲覧ガイド_mvp.md`](./APIリファレンス閲覧ガイド_mvp.md) |
| 2026-02-11 | AsyncAPIガバナンスエラー解消（LOCAL-DOCS-RENDER-03） | `asyncapi.yaml` の snapshot 例不足・messageId不足・metadata不足（tags/contact/license）を補完し、validateで error/warning を解消 | AsyncAPIの生成/可視化で失敗しない契約ドキュメント基盤を維持するため | [`asyncapi.yaml`](./asyncapi.yaml), [`APIリファレンス閲覧ガイド_mvp.md`](./APIリファレンス閲覧ガイド_mvp.md) |
| 2026-02-11 | M1完了確認とM2移行判定（M2-01） | M1-01〜M1-04の完了状態を再確認し、M2-01を `IN_PROGRESS` へ更新 | M2実装着手前に進捗整合を固定し、優先タスクの着手状態を明確化するため | [`進捗管理シート_mvp.md`](./進捗管理シート_mvp.md) |
| 2026-02-11 | M2-01 API契約固定（ロビー一覧） | `/api/lobby/tables` を OpenAPI `LobbyTablesResponse` 形式（`stakes` オブジェクト + `serverTime`）へ統一し、変換ロジックとAPI/E2Eテストを追加 | 仮レスポンス形式との差分を先に解消し、以降の履歴API/契約テスト実装での仕様ドリフトを防ぐため | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts), [`m0-04-foundation.e2e.test.ts`](../../apps/server/src/__tests__/e2e/m0-04-foundation.e2e.test.ts) |
| 2026-02-11 | M2-02 卓詳細API実装 | `/api/tables/:tableId` を OpenAPI `TableDetailResponse` 準拠で実装し、席状態・進行中ハンド要約を返すRepository/変換ロジックと統合テストを追加 | ロビー一覧から卓詳細への遷移時に契約固定済みデータを返し、M2-03以降の認証・履歴API実装に向けてHTTP土台を前進させるため | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`table-detail.ts`](../../apps/server/src/table-detail.ts), [`table-detail-repository.ts`](../../apps/server/src/repository/table-detail/contract.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| 2026-02-11 | M2-03 認証API基盤実装 | Google callback後にHttpOnly session cookieを発行し、`/api/auth/me`・`/api/auth/logout` でセッション参照/無効化を行う基盤を実装 | M2-04以降の履歴APIで認証済みユーザー軸のレスポンスを返すための共通土台が必要なため | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`auth-session.ts`](../../apps/server/src/auth-session.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| 2026-02-11 | M2-04 履歴一覧API実装 | `GET /api/history/hands` に認証前提のキーセットページング（`endedAt DESC, handId DESC`）と署名付きcursor検証を実装し、改ざん時 `INVALID_CURSOR` を返す | 履歴詳細API（M2-05）と契約テスト（M2-06）に先立ち、履歴一覧の順序保証とページング境界を先に固定するため | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`history-cursor.ts`](../../apps/server/src/history-cursor.ts), [`history-repository.ts`](../../apps/server/src/repository/history/contract.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| 2026-02-11 | M2-05 履歴詳細API実装 | `GET /api/history/hands/:handId` を実装し、streetActions/showdown/profitLoss を返却。履歴一覧との `handId/tableId/profitLoss` 整合を統合テストで固定 | 履歴画面で必要な詳細表示データを確定し、M2-06契約テストで正常/異常系を一括固定する前提を整えるため | [`openapi.yaml`](./openapi.yaml), [`apps/server/src/app.ts`](../../apps/server/src/app.ts), [`history-hand.ts`](../../apps/server/src/history-hand.ts), [`history-repository.ts`](../../apps/server/src/repository/history/contract.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts) |
| 2026-02-11 | M2-06 HTTP契約テスト固定 | OpenAPIで定義したMVP対象HTTP API（Auth/Lobby/Tables/History）の正常系・異常系を統合契約テストとして追加し、継続検証を自動化 | M2完了条件である「契約逸脱をCIで即検知できる状態」を満たすため | [`openapi.yaml`](./openapi.yaml), [`http-contract.integration.test.ts`](../../apps/server/src/__tests__/integration/http-contract.integration.test.ts), [`http-api.integration.test.ts`](../../apps/server/src/__tests__/integration/http-api.integration.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| 2026-02-11 | AsyncAPI表示方式の更新（LOCAL-DOCS-RENDER-04） | AsyncAPI表示を Web Component 直描画から AsyncAPI CLI + html-template による静的HTML生成へ切替 | ブラウザ実行時パーサー依存の表示エラーを回避し、Pages表示の再現性を高めるため | [`build-api-reference-site.sh`](../../scripts/build-api-reference-site.sh), [`APIリファレンス閲覧ガイド_mvp.md`](./APIリファレンス閲覧ガイド_mvp.md) |
| 2026-02-11 | 契約リテラル再発防止ルール導入（LOCAL-CONTRACT-LITERAL-01） | `apps/` 配下で `FIXED_LIMIT` / `STUD_*` の文字列直書きを検出する `pnpm check:contract-literals` を導入し、CI/PRテンプレート/運用ルールへ組み込む | 契約値変更時の追従漏れとテスト期待値のハードコード再発を防ぐため | [`check-contract-literals.sh`](../../scripts/check-contract-literals.sh), [`ci.yml`](../../.github/workflows/ci.yml), [`github-operations.md`](../../.agent/rules/github-operations.md), [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| 2026-02-12 | PR前品質ゲート更新（LOCAL-CONTRACT-LITERAL-02） | PR作成前の必須チェックを `pnpm lint` → `pnpm check:contract-literals` → `pnpm typecheck` → `pnpm test` へ統一 | PR作成時に `check:contract-literals` の実行漏れを防ぎ、契約リテラルの回帰混入を抑止するため | [`AGENTS.md`](../../AGENTS.md), [`github-operations.md`](../../.agent/rules/github-operations.md), [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| 2026-02-11 | M3-01 WebSocketゲートウェイ初期実装 | `ws` サーバーを `/ws` に追加し、セッション必須化・コマンド基本検証・`ping/pong`・`table.error` 応答を先行実装 | M3の後続タスク（Table Actor、席管理、進行制御）を段階実装できる最小Realtime基盤を先に固定するため | [`asyncapi.yaml`](./asyncapi.yaml), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`server.ts`](../../apps/server/src/realtime/server.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts) |
| 2026-02-11 | M3-02 Table Actor直列基盤の先行固定 | 卓ごとの処理キュー (`TableActor`) と `tableSeq/handSeq` 採番器を独立実装し、並行投入時の順序保証を単体テストで固定 | 席管理・ゲーム進行・再接続処理を後続タスクで実装する際に、順序逆転と競合を土台で防止するため | [`table-actor.ts`](../../apps/server/src/realtime/table-actor.ts), [`table-actor.unit.test.ts`](../../apps/server/src/__tests__/unit/table-actor.unit.test.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-11 | M3-03 席管理コマンド実装 | `table.join/sitOut/return/leave` を `RealtimeTableService` 上で実装し、`SeatStateChangedEvent` を `table.event` として配信する構成に更新 | M3-04以降のハンド進行実装に入る前に、席遷移とRealtime配信の整合を固定するため | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts) |
| 2026-02-11 | M3-04 ハンド開始〜3rd配札基盤実装 | 2人目着席時に `DealInit -> PostAnte -> DealCards3rd` を自動発行し、bring-in席確定までの初期進行基盤を実装（`BRING_IN` 実行は後続 `table.act` で処理） | M3-05以降のアクション合法性・ゲームルール・ショーダウン実装を進めるためのハンド状態土台が必要なため | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| 2026-02-12 | M3-05 アクション合法性実装 | `table.act` の5bet cap判定をヘッズアップ含む全卓へ統一し、手番検証・toCall時CHECK拒否と合わせて固定した | 実卓人数に依存しない単純なベッティング上限制約へ仕様統一し、判定分岐を減らすため | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| 2026-02-11 | M3-06 GameRule抽象の実装 | StudHi/Stud8/Razz で Bring-in/先手判定を切り替える `GameRule` を追加し、テーブル進行側からルール参照する構成へ更新 | ルール依存ロジックを分離して、M3-07以降のショーダウン評価やゲーム種拡張時の差分影響を局所化するため | [`game-rule.ts`](../../apps/server/src/realtime/game-rule.ts), [`game-rule.unit.test.ts`](../../apps/server/src/__tests__/unit/game-rule.unit.test.ts), [`table-service.ts`](../../apps/server/src/realtime/table-service.ts) |
| 2026-02-11 | M3-07 Showdown評価/分配ロジック実装 | Showdown評価器を追加し、Stud8 Hi/Lo分配・サイドポット・オッドチップ（Hi優先/ディーラー起点）を単体テストで固定 | HP-06/HP-07 と ED-04〜ED-08 をコード上で再現し、M3-08以降の進行/復元実装の前に配当ロジックを先に確定するため | [`showdown-evaluator.ts`](../../apps/server/src/realtime/showdown-evaluator.ts), [`showdown-evaluator.unit.test.ts`](../../apps/server/src/__tests__/unit/showdown-evaluator.unit.test.ts), [`E2Eシナリオ集_mvp.md`](./E2Eシナリオ集_mvp.md) |
| 2026-02-11 | M3-08 タイムアウト/切断処理実装 | 手番タイマーを導入し、タイムアウト時の自動 `CHECK/FOLD`（`isAuto=true`）と切断/再接続イベント、`disconnectStreak>=3` の自動LEAVE処理を追加 | NG-10とAutoAction要件をM3-09以降の再接続復元実装前に固定し、切断中進行の整合を先に担保するため | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`table-service.unit.test.ts`](../../apps/server/src/__tests__/unit/table-service.unit.test.ts), [`詳細設計書_mvp.md`](./詳細設計書_mvp.md) |
| 2026-02-11 | M3-09 再接続復元（resume/snapshot）実装 | `table.resume` を実装し、差分再送可能時は `table.event` 連番再送、保持外は `table.snapshot(reason=OUT_OF_RANGE)` フォールバックを返す構成へ更新 | HP-09/HP-11 の復元要件をM3-10再起動復元の前に固定し、再接続経路の整合性とsnapshot必須キーの維持を担保するため | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts), [`asyncapi.yaml`](./asyncapi.yaml) |
| 2026-02-11 | M3-10 サーバー再起動復元基盤実装 | Realtime状態の export/restore と actor採番復元を追加し、起動時に pending action table のタイマー再設定を行う構成へ更新 | HP-12で要求される「再起動後も tableSeq を継続して進行できる」性質をM3-11契約テスト前に固定するため | [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`table-actor.ts`](../../apps/server/src/realtime/table-actor.ts), [`server.ts`](../../apps/server/src/realtime/server.ts), [`ws-gateway.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-gateway.integration.test.ts) |
| 2026-02-13 | M3-11 Realtime契約テスト追加 | AsyncAPI記述と実際のWSメッセージ（`table.event/error/snapshot/pong`）の整合を統合テストで検証し、契約逸脱をCIで検出できる状態に更新 | M3完了条件であるRealtime契約逸脱ゼロを担保し、M4以降の画面実装で契約変更の破壊的影響を即時検知するため | [`ws-contract.integration.test.ts`](../../apps/server/src/__tests__/integration/ws-contract.integration.test.ts), [`asyncapi.yaml`](./asyncapi.yaml) |
| 2026-02-13 | 大規模ファイルの責務分割（LOCAL-REFACTOR-SPLIT-01） | `history-repository` / `showdown-evaluator` / `ws-gateway` / `table-service` を責務単位で分割し、型定義・純粋ロジック・オーケストレーションを分離した | 単一ファイル肥大化によるレビュー負荷と変更時の影響範囲把握コストを下げ、今後の機能追加時の安全性を高めるため | [`history-repository.ts`](../../apps/server/src/repository/history/contract.ts), [`showdown-evaluator.ts`](../../apps/server/src/realtime/showdown-evaluator.ts), [`ws-gateway.ts`](../../apps/server/src/realtime/ws-gateway.ts), [`table-service.ts`](../../apps/server/src/realtime/table-service.ts), [`table-service-seat-command.ts`](../../apps/server/src/realtime/table-service-seat-command.ts), [`table-service-act-command.ts`](../../apps/server/src/realtime/table-service-act-command.ts), [`table-service-hand.ts`](../../apps/server/src/realtime/table-service-hand.ts), [`実装推進ガイド_mvp.md`](./実装推進ガイド_mvp.md) |
| 2026-02-13 | M4-01 Web認証導線の実装方針 | `/login` と `/lobby` をSPAルートとして追加し、保護ルート初期表示時に `GET /api/auth/me` を実行して未認証ガードをかける方針を採用 | HP-01 の「callback後初期化」と「未認証ガード」をフロントで先行確立し、M4-02以降のロビー/卓画面へ段階拡張しやすくするため | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/auth-api.ts`](../../apps/web/src/auth-api.ts), [`openapi.yaml`](./openapi.yaml) |
| 2026-02-13 | M4-02 ロビー一覧と参加導線の実装方針 | `/api/lobby/tables` の取得結果をロビーカードとして表示し、`tableId/tableName/stakes/players/maxPlayers/gameType/emptySeats` を明示して `参加する` から `/tables/:tableId` へ遷移する方針を採用 | 要件定義 11.1 の表示要件をフロントで満たしつつ、M4-03 の卓画面実装へ自然に接続できる導線を先行確立するため | [`apps/web/src/App.tsx`](../../apps/web/src/App.tsx), [`apps/web/src/lobby-api.ts`](../../apps/web/src/lobby-api.ts), [`要件定義書_mvp.md`](./要件定義書_mvp.md) |

---

## 6. AIエージェント依頼テンプレート

```md
### Task
- 例: ロビーAPI `/api/lobby/tables` を詳細設計準拠で本実装化

### 参照ドキュメント
- docs/mvp/要件定義書_mvp.md: 該当節
- docs/mvp/詳細設計書_mvp.md: 該当節
- docs/mvp/openapi.yaml: 該当エンドポイント

### Acceptance Criteria
- [ ] 正常系レスポンスがOpenAPI通り
- [ ] 異常系（認可/入力不正）が定義通り
- [ ] 単体テスト追加
- [ ] `pnpm lint` / `pnpm check:contract-literals` / `pnpm typecheck` / `pnpm test` が通る
- [ ] 進捗管理シート更新

### Out of Scope
- 例: WebSocket実装は含めない
```

---

## 7. 週次レビュー記録

| Week | Done | In Progress | Risks | Next Focus |
| --- | --- | --- | --- | --- |
| 2026-W07 | 初版ドキュメント整備、実装タスク分解（Next/Backlog拡張）、M0-01〜M0-04完了、M1-01〜M1-04完了、M2-01〜M2-06完了、M3-01〜M3-11完了、M4-01〜M4-06完了、M5-00（現況監査）完了、M5-10完了、M5-11完了、M5-12の接続経路固定、M5-16完了、M5-17完了、M5-18完了、M5-19完了、M5-21完了、M5-22完了、M5-13完了 | M5-12（ローカル統合プレイ確認） | Realtime契約未検証範囲、表示名変更未実装、DEC-01 が残存 | M5-12 実施 -> M5-20 着手 |
