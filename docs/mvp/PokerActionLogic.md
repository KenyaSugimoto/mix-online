# ポーカー（スタッド系）のアクションルールと状態遷移ロジック

本ドキュメントでは、スタッド系ポーカー（7 Card Stud, Razz, Stud 8など）におけるプレイヤーのアクション選択可能ルールと、アクション実行時の状態遷移ロジックを、特定のプログラミング言語に依存しない自然言語（日本語）で記述します。

## 1. アクションの選択可能条件

プレイヤーが現在の手番でどのアクション（ベット、チェック、フォールドなど）を選択できるかは、以下の要素によって決定されます。

### ストリートによる基本ルール

ゲームの進行段階（ストリート）によって、可能なアクションのパターンが異なります。

#### 第3ストリート（ゲーム開始直後）の場合

1.  **アクション未発生の状態（誰もまだチップを出していない）**:
    *   **ブリングイン**: 強制ベットを行う。
    *   **コンプリート**: ブリングインの額ではなく、正規のベット額を賭ける。

2.  **ブリングインが発生した後**:
    *   **コール**: ブリングイン額と同額を出す。
    *   **フォールド**: ゲームから降りる。
    *   **コンプリート**: ベット額を正規の額（スモールベット額）に引き上げる。

3.  **コンプリート（正規ベット）が発生した後**:
    *   **コール**: 現在のベット額に合わせる。
    *   **フォールド**: ゲームから降りる。
    *   **レイズ**: ベット額をさらに上乗せする。
        *   ※レイズ回数が上限に達していない場合のみ可能。
    *   ※この段階では「コンプリート」は不可（既に完了しているため、次はレイズになる）。

#### 第4ストリート以降（第5, 6, 7ストリート含む）の場合

1.  **まだ誰もベットしていない場合（チェックで回ってきている場合含む）**:
    *   **チェック**: チップを出さずに次の人へ回す。
    *   **ベット**: チップを賭ける。
    *   ※この状況では「コール」「フォールド」「レイズ」は不可。

2.  **誰かがベット（またはレイズ）した後**:
    *   **コール**: 現在の最高ベット額に合わせる。
    *   **フォールド**: ゲームから降りる。
    *   **レイズ**: ベット額をさらに上乗せする。
        *   ※レイズ回数が上限に達していない場合のみ可能。

### 整理表：状況別・許可されるアクション

| 状況（現在の最高賭け額） | ブリングイン | コンプリート | ベット | チェック | コール | レイズ | フォールド |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **第3: 未アクション** | ○ | ○ | × | × | × | × | × |
| **第3: ブリングイン済** | × | ○ | × | × | ○ | × | ○ |
| **第3: コンプリート済** | × | × | × | × | ○ | ○ | ○ |
| **第4以降: ベットなし** | × | × | ○ | ○ | × | × | × |
| **第4以降: ベットあり** | × | × | × | × | ○ | ○ | ○ |

---

## 2. アクション実行時の処理（状態遷移）

プレイヤーがアクションを選択した際、ゲームの状態（ポット、プレイヤーの持ち点など）は以下のように更新されます。

### 共通処理「チップの支払い」

何かのアクションによってチップを支払う必要がある場合（ベット、コール、レイズなど）、以下のルールで処理します。

1.  **支払額の算出**:
    *   そのアクションに必要な「目標額」を計算する。
    *   プレイヤーが「そのストリートですでに支払った額」を差し引く。
    *   差額が、今回支払うべき額となる。
2.  **所持金チェック（オールイン判定）**:
    *   「今回支払うべき額」が「プレイヤーの現在の所持金（スタック）」より多い場合、**所持金全額**を支払う（オールイン）。
    *   そうでない場合、正規の額を支払う。
3.  **状態更新**:
    *   プレイヤーの所持金を減らす。
    *   プレイヤーの「合計投資額」を増やす。
    *   テーブル上の「ポット（チップの山）」を増やす。

### 各アクションごとの特有処理

#### アンティ支払い

*   **概要**: ゲーム参加費の支払い。
*   **処理**:
    *   設定されたアンティ額を支払う。
    *   （所持金が足りない場合は全額）

#### ブリングイン / コンプリート / ベット

*   **概要**: チップを賭けて攻撃するアクション。
*   **処理**:
    *   設定された額（ブリングイン額、または正規のベット額）を支払う。
    *   **現在の賭け額**をその額に更新する。
    *   **レイズ回数**のカウント処理:
        *   ブリングイン、コンプリート、ベットの場合は、回数をリセット（または1回目として扱う）。

#### レイズ

*   **概要**: 相手のベットに対してさらに上乗せするアクション。
*   **処理**:
    *   「現在の賭け額 + 上乗せ額」を支払う。
    *   **現在の賭け額**を更新する。
    *   **レイズ回数**を +1 する。
    *   全員の回答待ち状態（アグレッサー以外のアクティブプレイヤー全員）を再設定する。

#### コール

*   **概要**: 相手のベット額に合わせるアクション。
*   **処理**:
    *   「現在の賭け額」に足りない分を支払う。
    *   「回答待ち人数」を 1 減らす。

#### チェック

*   **概要**: 賭けずに様子を見るアクション。
*   **処理**:
    *   チップは支払わない。
    *   「チェックした人数」を +1 する。

#### フォールド

*   **概要**: ゲームから降りるアクション。
*   **処理**:
    *   そのプレイヤーを「非アクティブ」にする。
    *   以降、そのゲーム中はアクションができなくなる。
    *   「回答待ち人数」を 1 減らす（ベットに対するフォールドの場合）。

---

## 3. ゲーム進行（ターン遷移）のロジック

アクション完了後、次に誰の手番になるか、あるいは次のストリートに進むかは以下のロジックで決定します。

### 次のアクションプレイヤーの決定

1.  現在のプレイヤーの左隣（時計回り）のプレイヤーを確認する。
2.  そのプレイヤーが「フォールド」しておらず、「オールイン」もしていない（まだアクションの権利がある）場合、その人が次のプレイヤーとなる。
3.  そうでない場合、さらにその左隣を確認...と繰り返す。

### ストリート終了判定（次のラウンドへ進むか？）

以下のアまたはイの条件を満たしたとき、現在のベットラウンド（ストリート）は終了し、次のストリートへ進みます。

**ア. 全員がチェックした場合**:
    *   ベットが発生していない状態で、アクティブなプレイヤー全員がチェック済みになったとき。

**イ. ベットに対するcallが完了した場合**:
    *   ベット（またはレイズ）が発生している状態で、「call待ち人数」が 0 になったとき。
    *   つまり、ベットした人以外のアクティブなプレイヤー全員が、コールしたか、フォールドしたか、あるいはオールインで全額出し切ったとき。

### オールインによる除外特例

*   チップをすべて出し切った（オールイン）プレイヤーは、その後のベットアクションには参加できないため、手番は回ってこない（スキップされる）。ただし、ゲームの結果（勝敗判定）には参加し続ける。
