asyncapi: 2.6.0
id: "urn:mix-stud-online:mvp:realtime"
defaultContentType: application/json
info:
  title: Mix Stud Online MVP リアルタイムAPI仕様
  version: 0.1.0
  description: |
    Mix Stud Online MVP のWebSocket通信に関するAsyncAPI仕様書。
    卓操作、ゲームアクション、再接続復元、イベント配信に利用する
    クライアントコマンドとサーバープッシュメッセージを定義する。
  contact:
    name: Mix Stud Online Team
    url: https://github.com/KenyaSugimoto/mix-online
    email: noreply@mix-online.example
  license:
    name: Proprietary

tags:
  - name: realtime
    description: WebSocket経由のコマンド送受信と卓状態同期。

servers:
  local:
    url: localhost:3000
    protocol: ws
    description: ローカル開発用WebSocketエンドポイント
    security:
      - sessionCookie: []

channels:
  /ws:
    description: |
      リアルタイム進行制御と状態同期を行う単一WebSocketチャネル。
      イベント順序は卓単位で `tableSeq` の単調増加により保証する。
      欠番を検知したクライアントは `table.resume` を送信する。
    publish:
      operationId: clientSendCommand
      summary: クライアントからコマンドを送信
      message:
        oneOf:
          - $ref: "#/components/messages/TableJoinCommand"
          - $ref: "#/components/messages/TableSitOutCommand"
          - $ref: "#/components/messages/TableReturnCommand"
          - $ref: "#/components/messages/TableLeaveCommand"
          - $ref: "#/components/messages/TableActCommand"
          - $ref: "#/components/messages/TableResumeCommand"
          - $ref: "#/components/messages/PingCommand"
    subscribe:
      operationId: serverPushMessage
      summary: サーバーからイベント・エラー・スナップショットを配信
      message:
        oneOf:
          - $ref: "#/components/messages/TableEventMessage"
          - $ref: "#/components/messages/TableErrorMessage"
          - $ref: "#/components/messages/TableSnapshotMessage"
          - $ref: "#/components/messages/PongMessage"

components:
  securitySchemes:
    sessionCookie:
      type: httpApiKey
      in: cookie
      name: session
      description: OAuthコールバック時に発行されるHttpOnlyセッションCookie

  messages:
    TableJoinCommand:
      name: tableJoinCommand
      messageId: table.join.command
      title: table.join
      summary: 卓への着席要求
      payload:
        $ref: "#/components/schemas/TableJoinCommandPayload"
      examples:
        - payload:
            type: table.join
            requestId: 5210d950-c345-4d1c-95e9-85fed5216171
            sentAt: "2026-02-09T10:00:00.000Z"
            payload:
              tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
              buyIn: 1000

    TableSitOutCommand:
      name: tableSitOutCommand
      messageId: table.sitOut.command
      title: table.sitOut
      summary: 現在の席をSIT OUTへ切り替え
      payload:
        $ref: "#/components/schemas/TableSitOutCommandPayload"

    TableReturnCommand:
      name: tableReturnCommand
      messageId: table.return.command
      title: table.return
      summary: SIT OUTを解除しプレイ復帰（次に参加可能なハンドから）
      payload:
        $ref: "#/components/schemas/TableReturnCommandPayload"

    TableLeaveCommand:
      name: tableLeaveCommand
      messageId: table.leave.command
      title: table.leave
      summary: 卓から離席（即時、またはハンド中は離席予約）
      payload:
        $ref: "#/components/schemas/TableLeaveCommandPayload"

    TableActCommand:
      name: tableActCommand
      messageId: table.act.command
      title: table.act
      summary: 現在手番のゲームアクション送信
      payload:
        $ref: "#/components/schemas/TableActCommandPayload"
      examples:
        - payload:
            type: table.act
            requestId: 58b8a714-ae4f-4e15-aa85-60c85f14be57
            sentAt: "2026-02-09T10:05:11.120Z"
            payload:
              tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
              action: CALL

    TableResumeCommand:
      name: tableResumeCommand
      messageId: table.resume.command
      title: table.resume
      summary: 最終受信シーケンス以降の差分イベント再送要求
      payload:
        $ref: "#/components/schemas/TableResumeCommandPayload"
      examples:
        - payload:
            type: table.resume
            requestId: 3ed8becf-f8df-49e8-a9a6-98bd26da504e
            sentAt: "2026-02-09T10:06:00.000Z"
            payload:
              tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
              lastTableSeq: 127

    PingCommand:
      name: pingCommand
      messageId: ping.command
      title: ping
      summary: 生存確認コマンド
      payload:
        $ref: "#/components/schemas/PingCommandPayload"

    TableEventMessage:
      name: tableEventMessage
      messageId: table.event.message
      title: table.event
      summary: サーバー権威の卓イベント配信メッセージ
      payload:
        $ref: "#/components/schemas/TableEventMessagePayload"
      examples:
        - payload:
            type: table.event
            tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
            tableSeq: 128
            handId: 9056fdb5-1259-4186-9bc7-ce59131457f5
            handSeq: 44
            occurredAt: "2026-02-09T10:05:11.500Z"
            eventName: RaiseEvent
            payload:
              street: THIRD
              seatNo: 4
              amount: 40
              stackAfter: 860
              potAfter: 290
              streetBetTo: 40
              nextToActSeatNo: 5
              isAllIn: false
        - payload:
            type: table.event
            tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
            tableSeq: 94
            handId: 9056fdb5-1259-4186-9bc7-ce59131457f5
            handSeq: 3
            occurredAt: "2026-02-09T10:03:00.120Z"
            eventName: DealCards3rdEvent
            payload:
              street: THIRD
              bringInSeatNo: 1
              cards:
                - seatNo: 1
                  cards:
                    - position: HOLE_1
                      visibility: DOWN_HIDDEN
                      card: null
                    - position: HOLE_2
                      visibility: DOWN_HIDDEN
                      card: null
                    - position: UP_3
                      visibility: UP
                      card:
                        rank: K
                        suit: H
                - seatNo: 4
                  cards:
                    - position: HOLE_1
                      visibility: DOWN_SELF
                      card:
                        rank: A
                        suit: S
                    - position: HOLE_2
                      visibility: DOWN_SELF
                      card:
                        rank: "5"
                        suit: D
                    - position: UP_3
                      visibility: UP
                      card:
                        rank: "9"
                        suit: C
        - payload:
            type: table.event
            tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
            tableSeq: 211
            handId: 9056fdb5-1259-4186-9bc7-ce59131457f5
            handSeq: 59
            occurredAt: "2026-02-09T10:12:31.003Z"
            eventName: ShowdownEvent
            payload:
              hasShowdown: true
              showdownOrder:
                - 2
                - 4
              players:
                - seatNo: 2
                  userId: 818ac8d1-efbe-44ee-90ed-e435f6d0e57d
                  displayName: Alice
                  action: SHOW
                  cardsUp:
                    - rank: K
                      suit: C
                    - rank: K
                      suit: S
                    - rank: "9"
                      suit: S
                    - rank: "8"
                      suit: C
                  cardsDown:
                    - rank: A
                      suit: H
                    - rank: A
                      suit: D
                    - rank: "2"
                      suit: S
                  handLabel: Two Pair (Aces and Kings)
                - seatNo: 4
                  userId: 1a500a3b-b6ad-4fd8-b4f5-3f3a3b5f0103
                  displayName: Bob
                  action: MUCK
                  cardsUp:
                    - rank: J
                      suit: S
                    - rank: "7"
                      suit: C
                    - rank: "7"
                      suit: D
                    - rank: "3"
                      suit: H
                  cardsDown: []
                  handLabel: null
              potResults:
                - potNo: 1
                  side: SINGLE
                  amount: 680
                  winners:
                    - seatNo: 2
                      userId: 818ac8d1-efbe-44ee-90ed-e435f6d0e57d
                      displayName: Alice
                      amount: 680
                      handLabel: Two Pair (Aces and Kings)

    TableErrorMessage:
      name: tableErrorMessage
      messageId: table.error.message
      title: table.error
      summary: 状態変更なしでのコマンド拒否通知
      payload:
        $ref: "#/components/schemas/TableErrorMessagePayload"
      examples:
        - payload:
            type: table.error
            requestId: 58b8a714-ae4f-4e15-aa85-60c85f14be57
            tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
            code: NOT_YOUR_TURN
            message: あなたの手番ではありません。
            occurredAt: "2026-02-09T10:05:11.130Z"

    TableSnapshotMessage:
      name: tableSnapshotMessage
      messageId: table.snapshot.message
      title: table.snapshot
      summary: 要求範囲のイベントがない場合のスナップショット応答
      payload:
        $ref: "#/components/schemas/TableSnapshotMessagePayload"
      examples:
        - payload:
            type: table.snapshot
            tableId: cbf4d865-112d-4c22-8f54-95e2785e7024
            tableSeq: 212
            occurredAt: "2026-02-09T10:06:01.000Z"
            payload:
              reason: OUT_OF_RANGE
              table:
                status: BETTING
                gameType: STUD_HI
                stakes:
                  smallBet: 20
                  bigBet: 40
                  ante: 5
                  bringIn: 10
                seats:
                  - seatNo: 1
                    status: ACTIVE
                    stack: 860
                    disconnectStreak: 0
                    user:
                      userId: 818ac8d1-efbe-44ee-90ed-e435f6d0e57d
                      displayName: Alice
                  - seatNo: 2
                    status: ACTIVE
                    stack: 920
                    disconnectStreak: 0
                    user:
                      userId: 1a500a3b-b6ad-4fd8-b4f5-3f3a3b5f0103
                      displayName: Bob
                  - seatNo: 3
                    status: EMPTY
                    stack: 0
                    disconnectStreak: 0
                    user: null
                  - seatNo: 4
                    status: EMPTY
                    stack: 0
                    disconnectStreak: 0
                    user: null
                  - seatNo: 5
                    status: EMPTY
                    stack: 0
                    disconnectStreak: 0
                    user: null
                  - seatNo: 6
                    status: EMPTY
                    stack: 0
                    disconnectStreak: 0
                    user: null
                currentHand:
                  handId: 9056fdb5-1259-4186-9bc7-ce59131457f5
                  handNo: 44
                  status: IN_PROGRESS
                  street: THIRD
                  potTotal: 290
                  toActSeatNo: 1
                  actionDeadlineAt: "2026-02-09T10:06:31.000Z"
                dealerSeatNo: 2
                mixIndex: 0
                handsSinceRotation: 2

    PongMessage:
      name: pongMessage
      messageId: pong.message
      title: pong
      summary: 生存確認応答
      payload:
        $ref: "#/components/schemas/PongMessagePayload"

  schemas:
    UUID:
      type: string
      format: uuid

    DateTime:
      type: string
      format: date-time

    TableSeq:
      type: integer
      format: int64
      minimum: 0

    HandSeq:
      type: integer
      format: int64
      minimum: 0

    TableCommandAction:
      type: string
      enum:
        - FOLD
        - CHECK
        - CALL
        - BET
        - RAISE
        - COMPLETE
        - BRING_IN

    TableEventName:
      type: string
      enum:
        - DealInitEvent
        - DealCards3rdEvent
        - DealCardEvent
        - PostAnteEvent
        - BringInEvent
        - CompleteEvent
        - BetEvent
        - RaiseEvent
        - CallEvent
        - CheckEvent
        - FoldEvent
        - StreetAdvanceEvent
        - ShowdownEvent
        - DealEndEvent
        - SeatStateChangedEvent
        - PlayerDisconnectedEvent
        - PlayerReconnectedEvent

    SeatNo:
      type: integer
      minimum: 1
      maximum: 6

    GameType:
      type: string
      enum:
        - STUD_HI
        - RAZZ
        - STUD_8

    Street:
      type: string
      enum:
        - THIRD
        - FOURTH
        - FIFTH
        - SIXTH
        - SEVENTH

    SeatStatus:
      type: string
      enum:
        - EMPTY
        - SEATED_WAIT_NEXT_HAND
        - ACTIVE
        - SIT_OUT
        - DISCONNECTED
        - LEAVE_PENDING

    CardRank:
      type: string
      enum:
        - "A"
        - "K"
        - "Q"
        - "J"
        - "T"
        - "9"
        - "8"
        - "7"
        - "6"
        - "5"
        - "4"
        - "3"
        - "2"

    CardSuit:
      type: string
      enum:
        - S
        - H
        - D
        - C

    Card:
      type: object
      required:
        - rank
        - suit
      properties:
        rank:
          $ref: "#/components/schemas/CardRank"
        suit:
          $ref: "#/components/schemas/CardSuit"
      additionalProperties: false

    CardVisibility:
      type: string
      enum:
        - UP
        - DOWN_SELF
        - DOWN_HIDDEN

    ThirdStreetCardPosition:
      type: string
      enum:
        - HOLE_1
        - HOLE_2
        - UP_3

    ShowdownAction:
      type: string
      enum:
        - SHOW
        - MUCK

    PotSide:
      type: string
      enum:
        - SINGLE
        - HI
        - LO

    DealEndReason:
      type: string
      enum:
        - SHOWDOWN
        - UNCONTESTED
        - AUTO_END

    SeatStateChangeReason:
      type: string
      enum:
        - JOIN
        - SIT_OUT
        - RETURN
        - LEAVE_PENDING
        - LEAVE
        - AUTO_LEAVE_ZERO_STACK
        - NEXT_HAND_ACTIVATE
        - SYSTEM

    StakeSnapshot:
      type: object
      required:
        - smallBet
        - bigBet
        - ante
        - bringIn
      properties:
        smallBet:
          type: integer
          minimum: 0
        bigBet:
          type: integer
          minimum: 0
        ante:
          type: integer
          minimum: 0
        bringIn:
          type: integer
          minimum: 0
      additionalProperties: false

    SnapshotTableStatus:
      type: string
      enum:
        - WAITING
        - DEALING
        - BETTING
        - SHOWDOWN
        - HAND_END

    SnapshotHandStatus:
      type: string
      enum:
        - IN_PROGRESS
        - SHOWDOWN
        - HAND_END

    SnapshotSeat:
      type: object
      required:
        - seatNo
        - status
        - stack
        - disconnectStreak
        - user
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        status:
          $ref: "#/components/schemas/SeatStatus"
        stack:
          type: integer
          minimum: 0
        disconnectStreak:
          type: integer
          minimum: 0
        user:
          oneOf:
            - $ref: "#/components/schemas/SeatUserSummary"
            - type: "null"
      additionalProperties: false

    SnapshotCurrentHand:
      oneOf:
        - type: object
          required:
            - handId
            - handNo
            - status
            - street
            - potTotal
            - toActSeatNo
            - actionDeadlineAt
          properties:
            handId:
              $ref: "#/components/schemas/UUID"
            handNo:
              type: integer
              format: int64
              minimum: 1
            status:
              $ref: "#/components/schemas/SnapshotHandStatus"
            street:
              $ref: "#/components/schemas/Street"
            potTotal:
              type: integer
              minimum: 0
            toActSeatNo:
              oneOf:
                - $ref: "#/components/schemas/SeatNo"
                - type: "null"
            actionDeadlineAt:
              oneOf:
                - $ref: "#/components/schemas/DateTime"
                - type: "null"
          additionalProperties: false
        - type: "null"

    SnapshotTable:
      type: object
      required:
        - status
        - gameType
        - stakes
        - seats
        - currentHand
        - dealerSeatNo
        - mixIndex
        - handsSinceRotation
      properties:
        status:
          $ref: "#/components/schemas/SnapshotTableStatus"
        gameType:
          $ref: "#/components/schemas/GameType"
        stakes:
          $ref: "#/components/schemas/StakeSnapshot"
        seats:
          type: array
          minItems: 6
          maxItems: 6
          items:
            $ref: "#/components/schemas/SnapshotSeat"
        currentHand:
          $ref: "#/components/schemas/SnapshotCurrentHand"
        dealerSeatNo:
          $ref: "#/components/schemas/SeatNo"
        mixIndex:
          type: integer
          minimum: 0
          maximum: 2
        handsSinceRotation:
          type: integer
          minimum: 0
          maximum: 5
      additionalProperties: false

    HandParticipantSnapshot:
      type: object
      required:
        - seatNo
        - userId
        - displayName
        - startStack
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        userId:
          $ref: "#/components/schemas/UUID"
        displayName:
          type: string
          minLength: 1
          maxLength: 64
        startStack:
          type: integer
          minimum: 0
      additionalProperties: false

    SeatUserSummary:
      type: object
      required:
        - userId
        - displayName
      properties:
        userId:
          $ref: "#/components/schemas/UUID"
        displayName:
          type: string
          minLength: 1
          maxLength: 64
      additionalProperties: false

    DealtCardView:
      type: object
      required:
        - visibility
        - card
      properties:
        visibility:
          $ref: "#/components/schemas/CardVisibility"
        card:
          oneOf:
            - $ref: "#/components/schemas/Card"
            - type: "null"
      additionalProperties: false

    ThirdStreetDealtCardView:
      type: object
      required:
        - position
        - visibility
        - card
      properties:
        position:
          $ref: "#/components/schemas/ThirdStreetCardPosition"
        visibility:
          $ref: "#/components/schemas/CardVisibility"
        card:
          oneOf:
            - $ref: "#/components/schemas/Card"
            - type: "null"
      additionalProperties: false

    ThirdStreetSeatCards:
      type: object
      required:
        - seatNo
        - cards
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        cards:
          type: array
          minItems: 3
          maxItems: 3
          items:
            $ref: "#/components/schemas/ThirdStreetDealtCardView"
      additionalProperties: false

    StreetDealCard:
      type: object
      required:
        - seatNo
        - visibility
        - card
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        visibility:
          $ref: "#/components/schemas/CardVisibility"
        card:
          oneOf:
            - $ref: "#/components/schemas/Card"
            - type: "null"
      additionalProperties: false

    SeatContribution:
      type: object
      required:
        - seatNo
        - amount
        - stackAfter
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        amount:
          type: integer
          minimum: 0
        stackAfter:
          type: integer
          minimum: 0
      additionalProperties: false

    ChipActionEventPayload:
      type: object
      required:
        - street
        - seatNo
        - amount
        - stackAfter
        - potAfter
        - streetBetTo
        - nextToActSeatNo
        - isAllIn
      properties:
        street:
          $ref: "#/components/schemas/Street"
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        amount:
          type: integer
          minimum: 0
        stackAfter:
          type: integer
          minimum: 0
        potAfter:
          type: integer
          minimum: 0
        streetBetTo:
          type: integer
          minimum: 0
        nextToActSeatNo:
          oneOf:
            - $ref: "#/components/schemas/SeatNo"
            - type: "null"
        isAllIn:
          type: boolean
      additionalProperties: false

    PotWinner:
      type: object
      required:
        - seatNo
        - userId
        - displayName
        - amount
        - handLabel
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        userId:
          $ref: "#/components/schemas/UUID"
        displayName:
          type: string
          minLength: 1
          maxLength: 64
        amount:
          type: integer
          minimum: 0
        handLabel:
          oneOf:
            - type: string
            - type: "null"
      additionalProperties: false

    PotResult:
      type: object
      required:
        - potNo
        - side
        - amount
        - winners
      properties:
        potNo:
          type: integer
          minimum: 1
        side:
          $ref: "#/components/schemas/PotSide"
        amount:
          type: integer
          minimum: 0
        winners:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/PotWinner"
      additionalProperties: false

    SeatChipResult:
      type: object
      required:
        - seatNo
        - userId
        - displayName
        - delta
        - stackAfter
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        userId:
          $ref: "#/components/schemas/UUID"
        displayName:
          type: string
          minLength: 1
          maxLength: 64
        delta:
          type: integer
        stackAfter:
          type: integer
          minimum: 0
      additionalProperties: false

    DealInitEventPayload:
      type: object
      required:
        - handNo
        - gameType
        - street
        - dealerSeatNo
        - mixIndex
        - handsSinceRotation
        - stakes
        - participants
      properties:
        handNo:
          type: integer
          format: int64
          minimum: 1
        gameType:
          $ref: "#/components/schemas/GameType"
        street:
          type: string
          const: THIRD
        dealerSeatNo:
          $ref: "#/components/schemas/SeatNo"
        mixIndex:
          type: integer
          minimum: 0
          maximum: 2
        handsSinceRotation:
          type: integer
          minimum: 0
          maximum: 5
        stakes:
          $ref: "#/components/schemas/StakeSnapshot"
        participants:
          type: array
          minItems: 2
          maxItems: 6
          items:
            $ref: "#/components/schemas/HandParticipantSnapshot"
      additionalProperties: false

    DealCards3rdEventPayload:
      type: object
      required:
        - street
        - bringInSeatNo
        - cards
      properties:
        street:
          type: string
          const: THIRD
        bringInSeatNo:
          $ref: "#/components/schemas/SeatNo"
        cards:
          type: array
          minItems: 2
          maxItems: 6
          items:
            $ref: "#/components/schemas/ThirdStreetSeatCards"
      additionalProperties: false

    DealCardEventPayload:
      type: object
      required:
        - street
        - cards
        - toActSeatNo
        - potAfter
      properties:
        street:
          type: string
          enum:
            - FOURTH
            - FIFTH
            - SIXTH
            - SEVENTH
        cards:
          type: array
          minItems: 1
          maxItems: 6
          items:
            $ref: "#/components/schemas/StreetDealCard"
        toActSeatNo:
          oneOf:
            - $ref: "#/components/schemas/SeatNo"
            - type: "null"
        potAfter:
          type: integer
          minimum: 0
      additionalProperties: false

    PostAnteEventPayload:
      type: object
      required:
        - street
        - contributions
        - potAfter
      properties:
        street:
          type: string
          const: THIRD
        contributions:
          type: array
          minItems: 2
          maxItems: 6
          items:
            $ref: "#/components/schemas/SeatContribution"
        potAfter:
          type: integer
          minimum: 0
      additionalProperties: false

    BringInEventPayload:
      type: object
      required:
        - street
        - seatNo
        - amount
        - stackAfter
        - potAfter
        - nextToActSeatNo
        - isAllIn
      properties:
        street:
          type: string
          const: THIRD
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        amount:
          type: integer
          minimum: 0
        stackAfter:
          type: integer
          minimum: 0
        potAfter:
          type: integer
          minimum: 0
        nextToActSeatNo:
          oneOf:
            - $ref: "#/components/schemas/SeatNo"
            - type: "null"
        isAllIn:
          type: boolean
      additionalProperties: false

    CompleteEventPayload:
      type: object
      required:
        - street
        - seatNo
        - amount
        - stackAfter
        - potAfter
        - streetBetTo
        - nextToActSeatNo
        - isAllIn
      properties:
        street:
          type: string
          const: THIRD
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        amount:
          type: integer
          minimum: 0
        stackAfter:
          type: integer
          minimum: 0
        potAfter:
          type: integer
          minimum: 0
        streetBetTo:
          type: integer
          minimum: 0
        nextToActSeatNo:
          oneOf:
            - $ref: "#/components/schemas/SeatNo"
            - type: "null"
        isAllIn:
          type: boolean
      additionalProperties: false

    BetEventPayload:
      $ref: "#/components/schemas/ChipActionEventPayload"

    RaiseEventPayload:
      $ref: "#/components/schemas/ChipActionEventPayload"

    CallEventPayload:
      $ref: "#/components/schemas/ChipActionEventPayload"

    CheckEventPayload:
      type: object
      required:
        - street
        - seatNo
        - potAfter
        - nextToActSeatNo
        - isAuto
      properties:
        street:
          $ref: "#/components/schemas/Street"
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        potAfter:
          type: integer
          minimum: 0
        nextToActSeatNo:
          oneOf:
            - $ref: "#/components/schemas/SeatNo"
            - type: "null"
        isAuto:
          type: boolean
          description: |
            `true` の場合はタイムアウト等による自動行動。
            `false` の場合はプレイヤー手動操作。
      additionalProperties: false

    FoldEventPayload:
      type: object
      required:
        - street
        - seatNo
        - potAfter
        - nextToActSeatNo
        - remainingPlayers
        - isAuto
      properties:
        street:
          $ref: "#/components/schemas/Street"
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        potAfter:
          type: integer
          minimum: 0
        nextToActSeatNo:
          oneOf:
            - $ref: "#/components/schemas/SeatNo"
            - type: "null"
        remainingPlayers:
          type: integer
          minimum: 1
          maximum: 6
        isAuto:
          type: boolean
          description: |
            `true` の場合はタイムアウト等による自動行動。
            `false` の場合はプレイヤー手動操作。
      additionalProperties: false

    StreetAdvanceEventPayload:
      type: object
      required:
        - fromStreet
        - toStreet
        - potTotal
        - activeSeatNos
        - nextToActSeatNo
        - tableStatus
        - reason
      properties:
        fromStreet:
          $ref: "#/components/schemas/Street"
        toStreet:
          oneOf:
            - $ref: "#/components/schemas/Street"
            - type: "null"
        potTotal:
          type: integer
          minimum: 0
        activeSeatNos:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            $ref: "#/components/schemas/SeatNo"
        nextToActSeatNo:
          oneOf:
            - $ref: "#/components/schemas/SeatNo"
            - type: "null"
        tableStatus:
          type: string
          enum:
            - BETTING
            - SHOWDOWN
            - HAND_END
        reason:
          oneOf:
            - type: string
              const: BETTING_ROUND_COMPLETE
              description: ベッティングラウンドが正規に完了し、次ストリートへ遷移した。
            - type: string
              const: ALL_IN_RUNOUT
              description: アクション不能（全員all-in等）のため残りストリートをランアウト進行した。
            - type: string
              const: HAND_CLOSED
              description: "ハンド継続条件が消滅（例: 残り1人）してハンド終了状態へ遷移した。"
      additionalProperties: false

    ShowdownPlayer:
      type: object
      required:
        - seatNo
        - userId
        - displayName
        - action
        - cardsUp
        - cardsDown
        - handLabel
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        userId:
          $ref: "#/components/schemas/UUID"
        displayName:
          type: string
          minLength: 1
          maxLength: 64
        action:
          $ref: "#/components/schemas/ShowdownAction"
        cardsUp:
          type: array
          items:
            $ref: "#/components/schemas/Card"
        cardsDown:
          type: array
          items:
            $ref: "#/components/schemas/Card"
        handLabel:
          oneOf:
            - type: string
            - type: "null"
      additionalProperties: false

    ShowdownEventPayload:
      type: object
      description: |
        Showdown が発生した場合にのみ配信される。
        uncontested（全員foldなど）で Showdown 不要の場合は本イベントを送信せず、
        `DealEndEvent.endReason=UNCONTESTED` で終局を表現する。
      required:
        - hasShowdown
        - showdownOrder
        - players
        - potResults
      properties:
        hasShowdown:
          type: boolean
          const: true
        showdownOrder:
          type: array
          minItems: 1
          uniqueItems: true
          items:
            $ref: "#/components/schemas/SeatNo"
        players:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/ShowdownPlayer"
        potResults:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/PotResult"
      additionalProperties: false

    DealEndEventPayload:
      type: object
      required:
        - endReason
        - finalPot
        - results
        - nextDealerSeatNo
        - nextGameType
        - mixIndex
        - handsSinceRotation
      properties:
        endReason:
          $ref: "#/components/schemas/DealEndReason"
        finalPot:
          type: integer
          minimum: 0
        results:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/SeatChipResult"
        nextDealerSeatNo:
          $ref: "#/components/schemas/SeatNo"
        nextGameType:
          $ref: "#/components/schemas/GameType"
        mixIndex:
          type: integer
          minimum: 0
          maximum: 2
        handsSinceRotation:
          type: integer
          minimum: 0
          maximum: 5
      additionalProperties: false

    SeatStateChangedEventPayload:
      type: object
      required:
        - seatNo
        - previousStatus
        - currentStatus
        - reason
        - user
        - stack
        - appliesFrom
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        previousStatus:
          $ref: "#/components/schemas/SeatStatus"
        currentStatus:
          $ref: "#/components/schemas/SeatStatus"
        reason:
          $ref: "#/components/schemas/SeatStateChangeReason"
        user:
          oneOf:
            - $ref: "#/components/schemas/SeatUserSummary"
            - type: "null"
        stack:
          type: integer
          minimum: 0
        appliesFrom:
          type: string
          enum:
            - IMMEDIATE
            - NEXT_HAND
      additionalProperties: false

    PlayerDisconnectedEventPayload:
      type: object
      required:
        - seatNo
        - userId
        - displayName
        - seatStatus
        - disconnectStreak
        - willAutoLeave
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        userId:
          $ref: "#/components/schemas/UUID"
        displayName:
          type: string
          minLength: 1
          maxLength: 64
        seatStatus:
          type: string
          const: DISCONNECTED
        disconnectStreak:
          type: integer
          minimum: 1
        willAutoLeave:
          type: boolean
      additionalProperties: false

    PlayerReconnectedEventPayload:
      type: object
      required:
        - seatNo
        - userId
        - displayName
        - restoredSeatStatus
        - disconnectStreakResetTo
      properties:
        seatNo:
          $ref: "#/components/schemas/SeatNo"
        userId:
          $ref: "#/components/schemas/UUID"
        displayName:
          type: string
          minLength: 1
          maxLength: 64
        restoredSeatStatus:
          type: string
          enum:
            - ACTIVE
            - SEATED_WAIT_NEXT_HAND
            - SIT_OUT
            - LEAVE_PENDING
        disconnectStreakResetTo:
          type: integer
          const: 0
      additionalProperties: false

    RealtimeErrorCode:
      type: string
      enum:
        - INVALID_ACTION
        - NOT_YOUR_TURN
        - INSUFFICIENT_CHIPS
        - TABLE_FULL
        - BUYIN_OUT_OF_RANGE
        - ALREADY_SEATED
        - AUTH_EXPIRED

    BaseClientCommand:
      type: object
      required:
        - type
        - requestId
        - sentAt
        - payload
      properties:
        type:
          type: string
        requestId:
          $ref: "#/components/schemas/UUID"
        sentAt:
          $ref: "#/components/schemas/DateTime"
          description: |
            クライアント送信時刻（参照用途）。順序や正史判定には利用しない。
            サーバー時刻 `occurredAt` / `tableSeq` を正とする。
        payload:
          type: object
      additionalProperties: false

    TableJoinCommandPayload:
      allOf:
        - $ref: "#/components/schemas/BaseClientCommand"
        - type: object
          properties:
            type:
              type: string
              const: table.join
            payload:
              type: object
              required:
                - tableId
                - buyIn
              properties:
                tableId:
                  $ref: "#/components/schemas/UUID"
                buyIn:
                  type: integer
                  minimum: 400
                  maximum: 2000
              additionalProperties: false

    TableSitOutCommandPayload:
      allOf:
        - $ref: "#/components/schemas/BaseClientCommand"
        - type: object
          properties:
            type:
              type: string
              const: table.sitOut
            payload:
              type: object
              required:
                - tableId
              properties:
                tableId:
                  $ref: "#/components/schemas/UUID"
              additionalProperties: false

    TableReturnCommandPayload:
      allOf:
        - $ref: "#/components/schemas/BaseClientCommand"
        - type: object
          properties:
            type:
              type: string
              const: table.return
            payload:
              type: object
              required:
                - tableId
              properties:
                tableId:
                  $ref: "#/components/schemas/UUID"
              additionalProperties: false

    TableLeaveCommandPayload:
      allOf:
        - $ref: "#/components/schemas/BaseClientCommand"
        - type: object
          properties:
            type:
              type: string
              const: table.leave
            payload:
              type: object
              required:
                - tableId
              properties:
                tableId:
                  $ref: "#/components/schemas/UUID"
              additionalProperties: false

    TableActCommandPayload:
      allOf:
        - $ref: "#/components/schemas/BaseClientCommand"
        - type: object
          properties:
            type:
              type: string
              const: table.act
            payload:
              type: object
              required:
                - tableId
                - action
              properties:
                tableId:
                  $ref: "#/components/schemas/UUID"
                action:
                  $ref: "#/components/schemas/TableCommandAction"
                amount:
                  description: |
                    `BET` / `RAISE` / `COMPLETE` / `BRING_IN` のときは数値を指定する。
                    `CHECK` / `FOLD` / `CALL` では `null` を推奨（0との意味差を避けるため）。
                  oneOf:
                    - type: integer
                      minimum: 0
                    - type: "null"
              additionalProperties: false

    TableResumeCommandPayload:
      allOf:
        - $ref: "#/components/schemas/BaseClientCommand"
        - type: object
          properties:
            type:
              type: string
              const: table.resume
            payload:
              type: object
              required:
                - tableId
                - lastTableSeq
              properties:
                tableId:
                  $ref: "#/components/schemas/UUID"
                lastTableSeq:
                  $ref: "#/components/schemas/TableSeq"
              additionalProperties: false

    PingCommandPayload:
      allOf:
        - $ref: "#/components/schemas/BaseClientCommand"
        - type: object
          properties:
            type:
              type: string
              const: ping
            payload:
              type: object
              additionalProperties: false

    DealInitEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: DealInitEvent
        payload:
          $ref: "#/components/schemas/DealInitEventPayload"
      additionalProperties: false

    DealCards3rdEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: DealCards3rdEvent
        payload:
          $ref: "#/components/schemas/DealCards3rdEventPayload"
      additionalProperties: false

    DealCardEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: DealCardEvent
        payload:
          $ref: "#/components/schemas/DealCardEventPayload"
      additionalProperties: false

    PostAnteEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: PostAnteEvent
        payload:
          $ref: "#/components/schemas/PostAnteEventPayload"
      additionalProperties: false

    BringInEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: BringInEvent
        payload:
          $ref: "#/components/schemas/BringInEventPayload"
      additionalProperties: false

    CompleteEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: CompleteEvent
        payload:
          $ref: "#/components/schemas/CompleteEventPayload"
      additionalProperties: false

    BetEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: BetEvent
        payload:
          $ref: "#/components/schemas/BetEventPayload"
      additionalProperties: false

    RaiseEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: RaiseEvent
        payload:
          $ref: "#/components/schemas/RaiseEventPayload"
      additionalProperties: false

    CallEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: CallEvent
        payload:
          $ref: "#/components/schemas/CallEventPayload"
      additionalProperties: false

    CheckEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: CheckEvent
        payload:
          $ref: "#/components/schemas/CheckEventPayload"
      additionalProperties: false

    FoldEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: FoldEvent
        payload:
          $ref: "#/components/schemas/FoldEventPayload"
      additionalProperties: false

    StreetAdvanceEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: StreetAdvanceEvent
        payload:
          $ref: "#/components/schemas/StreetAdvanceEventPayload"
      additionalProperties: false

    ShowdownEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: ShowdownEvent
        payload:
          $ref: "#/components/schemas/ShowdownEventPayload"
      additionalProperties: false

    DealEndEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - handId
        - handSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          $ref: "#/components/schemas/UUID"
        handSeq:
          $ref: "#/components/schemas/HandSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: DealEndEvent
        payload:
          $ref: "#/components/schemas/DealEndEventPayload"
      additionalProperties: false

    SeatStateChangedEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          oneOf:
            - $ref: "#/components/schemas/UUID"
            - type: "null"
        handSeq:
          oneOf:
            - $ref: "#/components/schemas/HandSeq"
            - type: "null"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: SeatStateChangedEvent
        payload:
          $ref: "#/components/schemas/SeatStateChangedEventPayload"
      additionalProperties: false

    PlayerDisconnectedEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          oneOf:
            - $ref: "#/components/schemas/UUID"
            - type: "null"
        handSeq:
          oneOf:
            - $ref: "#/components/schemas/HandSeq"
            - type: "null"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: PlayerDisconnectedEvent
        payload:
          $ref: "#/components/schemas/PlayerDisconnectedEventPayload"
      additionalProperties: false

    PlayerReconnectedEventMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - occurredAt
        - eventName
        - payload
      properties:
        type:
          type: string
          const: table.event
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        handId:
          oneOf:
            - $ref: "#/components/schemas/UUID"
            - type: "null"
        handSeq:
          oneOf:
            - $ref: "#/components/schemas/HandSeq"
            - type: "null"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        eventName:
          type: string
          const: PlayerReconnectedEvent
        payload:
          $ref: "#/components/schemas/PlayerReconnectedEventPayload"
      additionalProperties: false

    TableEventMessagePayload:
      oneOf:
        - $ref: "#/components/schemas/DealInitEventMessagePayload"
        - $ref: "#/components/schemas/DealCards3rdEventMessagePayload"
        - $ref: "#/components/schemas/DealCardEventMessagePayload"
        - $ref: "#/components/schemas/PostAnteEventMessagePayload"
        - $ref: "#/components/schemas/BringInEventMessagePayload"
        - $ref: "#/components/schemas/CompleteEventMessagePayload"
        - $ref: "#/components/schemas/BetEventMessagePayload"
        - $ref: "#/components/schemas/RaiseEventMessagePayload"
        - $ref: "#/components/schemas/CallEventMessagePayload"
        - $ref: "#/components/schemas/CheckEventMessagePayload"
        - $ref: "#/components/schemas/FoldEventMessagePayload"
        - $ref: "#/components/schemas/StreetAdvanceEventMessagePayload"
        - $ref: "#/components/schemas/ShowdownEventMessagePayload"
        - $ref: "#/components/schemas/DealEndEventMessagePayload"
        - $ref: "#/components/schemas/SeatStateChangedEventMessagePayload"
        - $ref: "#/components/schemas/PlayerDisconnectedEventMessagePayload"
        - $ref: "#/components/schemas/PlayerReconnectedEventMessagePayload"

    TableErrorMessagePayload:
      type: object
      required:
        - type
        - code
        - message
        - occurredAt
      properties:
        type:
          type: string
          const: table.error
        requestId:
          description: |
            コマンド起因エラーの場合に設定される。セッション期限切れ等の
            非コマンド起因エラーでは `null` の場合がある。
          oneOf:
            - $ref: "#/components/schemas/UUID"
            - type: "null"
        tableId:
          description: |
            卓コンテキストを特定できる場合に設定される。接続直後の認証エラー等
            卓未確定時は `null` の場合がある。
          oneOf:
            - $ref: "#/components/schemas/UUID"
            - type: "null"
        code:
          $ref: "#/components/schemas/RealtimeErrorCode"
        message:
          type: string
        occurredAt:
          $ref: "#/components/schemas/DateTime"
      additionalProperties: false

    TableSnapshotMessagePayload:
      type: object
      required:
        - type
        - tableId
        - tableSeq
        - occurredAt
        - payload
      properties:
        type:
          type: string
          const: table.snapshot
        tableId:
          $ref: "#/components/schemas/UUID"
        tableSeq:
          $ref: "#/components/schemas/TableSeq"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
        payload:
          type: object
          description: フル状態再同期に利用するスナップショット本体。
          required:
            - reason
            - table
          properties:
            reason:
              type: string
              enum:
                - OUT_OF_RANGE
                - RESYNC_REQUIRED
            table:
              $ref: "#/components/schemas/SnapshotTable"
          additionalProperties: false
      additionalProperties: false

    PongMessagePayload:
      type: object
      required:
        - type
        - requestId
        - occurredAt
      properties:
        type:
          type: string
          const: pong
        requestId:
          $ref: "#/components/schemas/UUID"
        occurredAt:
          $ref: "#/components/schemas/DateTime"
      additionalProperties: false
