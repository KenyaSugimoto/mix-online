# M5-34〜M5-40 実機確認フィードバックのチケット分割メモ

- 作成日: 2026-02-15
- 対象: 動作確認で抽出した改善要望・不具合のチケット化
- 関連: [`進捗管理シート_mvp.md`](../進捗管理シート_mvp.md), [`画面設計書_mvp.md`](../画面設計書_mvp.md), [`状態遷移図_mvp.md`](../状態遷移図_mvp.md), [`要件定義書_mvp.md`](../要件定義書_mvp.md)

---

## M5-34: `apps/web/src` リファクタリング（コンポーネント分割 + ディレクトリ分割 + CSS分割）

### 目的
肥大化したUIファイルを責務単位で分割し、変更時の影響範囲とレビュー負荷を下げる。

### 背景
`table-screen.tsx` と `app.css` にロジック/スタイルが集中し、UI改修で差分が肥大化している。

### 実装方針
- `apps/web/src/table-screen.tsx` を表示責務ごとに分割し、`components/` と `features/table/` を導入する。
- スタイルをレイアウト・共通UI・画面固有の単位に分離し、`app.css` の責務を最小化する。
- 既存の見た目と操作導線は維持し、分割のみを主目的とする。

### 完了条件
- [ ] 2,000行超クラスの単一ファイルが責務単位に分割されている。
- [ ] 分割後も見た目/操作に退行がない（手動確認 + 既存テスト）。
- [ ] 主要UI修正で影響範囲が限定されるディレクトリ構成になっている。

---

## M5-35: UIデザイン系Skills運用の導入（設計生成 + 実装前後レビュー手順の固定）

### 目的
UIタスクでデザイン品質の標準手順を固定し、毎回同じ粒度で設計・実装・レビューを回せるようにする。

### 背景
UI改善タスクが増え、都度判断で進めると品質ばらつきやレビュー負荷が増える。

### 実装方針
- UIタスク着手時に `ui-ux-pro-max` の方針生成を必須化する。
- 実装時は `frontend-design`、実装後確認は `web-design-guidelines` を必須適用する。
- 実行ログ（参照した方針/チェック項目/差分理由）をチケットまたは進捗管理シートへ記録する。

### 完了条件
- [ ] UI関連チケットの手順に3技能の適用順が明記されている。
- [ ] `ui-ux-pro-max` の方針生成結果を参照した記録が残っている。
- [ ] 実装後レビュー（`web-design-guidelines`）の観点がチェックリスト化されている。

---

## M5-36: シートパネル横幅調整（7枚カード基準で最適化）

### 目的
各席のカード表示領域を実利用サイズに合わせ、横幅の無駄を減らす。

### 背景
現状の席パネル幅が実際のカード表示量より広く、余白が目立っている。

### 実装方針
- 7枚カード（重なり表示を含む）が収まる最小幅を基準に席パネル幅を再定義する。
- デスクトップ/モバイルで破綻しないようブレークポイント別に調整する。
- 他の要素（席名、スタック、状態バッジ）との干渉を防ぐ。

### 完了条件
- [ ] 席パネルが7枚カード基準で過不足ない幅に調整されている。
- [ ] 横余白の過剰感が解消され、情報密度が改善している。
- [ ] デスクトップ/モバイル双方でレイアウト崩れがない。

---

## M5-37: 離席状態インジケーター改善（Slack風オンライン/オフライン表示）

### 目的
離席/接続状態を短い視覚記号で即判別できるようにする。

### 背景
現状の離席表示は文言中心で、一覧性と瞬時判読に改善余地がある。

### 実装方針
- `ACTIVE` / `SIT_OUT` / `DISCONNECTED` を色と短いラベルで統一表現する。
- Slackのオンライン/オフラインに近い簡潔な見せ方を採用し、補助テキストは最小化する。
- 色以外でも判別できるようテキスト/アイコンを併用する。

### 完了条件
- [ ] 状態判別が1視線で可能な表示へ置き換わっている。
- [ ] `LEAVE_PENDING` を含む離席関連状態の誤認が起きにくい。
- [ ] アクセシビリティ（色依存回避）を満たしている。

---

## M5-38: 席別直近アクション表示の再設計（ストリート切替クリア + ラベル配置調整）

### 目的
席ごとの直近アクションと結果ラベルを読みやすく整理し、情報の縦伸びを抑える。

### 背景
直近アクションがストリート跨ぎで残留し、獲得ポット額/役ラベルの縦積みで席パネルが伸びる。

### 実装方針
- `StreetAdvance` 時に `lastActionBySeatNo` をクリアする。
- 獲得ポット額と役判定ラベルを同一行またはコンパクトな2段構成へ再配置する。
- ラベル表示の優先順位を定義し、複数ラベル時でも高さを抑える。

### 完了条件
- [ ] ストリート遷移時に前ストリートの直近アクションが残らない。
- [ ] ラベル表示で席パネルの縦方向膨張が抑制される。
- [ ] 直近アクション・獲得ポット額・役情報の読み取り順が明確になる。

---

## M5-39: 切断復帰時のタイムアウト即時自動アクション補正

### 目的
タイムアウト時の自動アクションを「次イベント待ち」ではなく期限到達時点で即時反映する。

### 背景
切断後に再入室したケースで、UI上は時間切れでも実際のFOLD確定が遅延することがある。

### 実装方針
- 手番期限超過時の `CHECK/FOLD` 自動処理を即時発火させる経路を見直す。
- 切断/復帰シーケンスでもタイマー評価の基準時刻がずれないよう補正する。
- unit/integrationテストで「切断→期限超過→復帰」ケースを固定化する。

### 完了条件
- [ ] 期限超過直後に自動アクションが確定し、次操作待ちにならない。
- [ ] 復帰直後に旧手番が残留しない。
- [ ] 再現シナリオがテストで継続検知できる。

---

## M5-40: ヘッズアップ切断復帰時の不正アクション可否不具合修正

### 目的
2人卓での切断/復帰境界で、タイムアウト済みプレイヤーが再度操作できてしまう不整合を解消する。

### 背景
「ロビーへ戻る（disconnect）→離席化→復帰」で、本来自動FOLD想定の席が行動選択可能になるケースがある。

### 実装方針
- 2人卓の進行停止条件と自動アクション条件の優先順位を明確化する。
- タイムアウト確定済み席に対して、復帰時の操作可否を再評価して封じる。
- M5-39の即時自動アクション補正を前提に、ヘッズアップ専用再現ケースを追加する。

### 完了条件
- [ ] 2人卓で切断/復帰しても、タイムアウト済み席の行動選択は復活しない。
- [ ] 自動FOLD後の卓進行が一貫して継続する。
- [ ] 再現手順をテストで固定化し、回帰を検知できる。

---

## Out of Scope（本メモ作成時点）

- 本メモ内での実装着手
- API/WS契約の新規追加（必要な場合は実装チケットで別途起票）
