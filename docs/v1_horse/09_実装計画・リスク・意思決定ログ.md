# Mix Online v1 HORSE 実装計画・リスク・意思決定ログ

> 作成日: 2026-02-13 ｜ 対象バージョン: v1 ｜ ステータス: Draft

## 1. 目的

設計から実装までの進行管理を一本化し、判断履歴を残す。

## 2. タスク情報

- Task ID: `V1-HORSE-DOCS-001`
- ステータス: Drafting
- オーナー: AI Agent + Maintainer

## 3. 実装フェーズ案

### Phase 0: 契約準備

- `GameType` 拡張
- `mixIndex` 拡張
- OpenAPI/AsyncAPI 初版確定

### Phase 1: ルールエンジン拡張

- Hold'em / Omaha8 ルール追加
- Stud 系と Flop 系の進行抽象分離

### Phase 2: データ層拡張

- DB スキーマ追加
- 履歴再構築ロジック更新

### Phase 3: UI 統合

- テーブル画面の gameType 別表示
- 履歴詳細表示の分岐対応

### Phase 4: 検証/安定化

- E2E シナリオ実装
- 回帰試験
- 監視項目更新

## 4. リスクログ

| ID   | リスク                        | 影響 | 緩和策                       | 状態 |
| ---- | ----------------------------- | ---- | ---------------------------- | ---- |
| R-01 | Flop 系導入で状態遷移が複雑化 | 高   | Street family 抽象導入       | Open |
| R-02 | enum 追加で旧クライアント破綻 | 高   | 未知 enum フォールバック実装 | Open |
| R-03 | Hi/Lo 判定実装ミス            | 高   | ルール単体 + E2E 境界値追加  | Open |
| R-04 | ローテーション境界バグ        | 中   | 30ハンド連続テスト           | Open |

## 5. 意思決定ログ（簡易ADR）

### ADR-001

- 日付: 2026-02-13
- 決定: v1 は `FIXED_LIMIT` のみに限定
- 理由: ルール実装と運用複雑性を抑え、品質優先でリリースするため

### ADR-002

- 日付: 2026-02-13
- 決定: API は MVP 互換維持を基本に加算拡張
- 理由: 破壊的変更を最小化し、移行コストと不具合リスクを下げるため

### ADR-003

- 日付: 2026-02-13
- 決定: ローテーションは 6 ハンド固定を継続
- 理由: MVP 運用との整合性とユーザー体験の連続性を維持するため

### ADR-004

- 日付: 2026-02-14
- 決定: Hold'em / Omaha8 のブラインドは SB=$10（smallBet/2）、BB=$20（smallBet）
- 理由: Fixed Limit 標準に準拠

### ADR-005

- 日付: 2026-02-14
- 決定: Flop 系（Hold'em, Omaha8）では Ante を徴収しない
- 理由: ゲーム種別ごとの強制ベット構造を明確に分離するため

### ADR-006

- 日付: 2026-02-14
- 決定: 4th street open pair ルール（big bet 選択可）は不採用
- 理由: ルールの複雑性を抑制し、MVP からの拡張をシンプルに保つため

### ADR-007

- 日付: 2026-02-14
- 決定: Flop 系の hole card 配札は新規 `DealHoleCardsEvent` で通知
- 理由: Stud 系の `DealCards3rdEvent` と対称的な設計を維持するため

### ADR-008

- 日付: 2026-02-14
- 決定: 再接続スナップショット `SnapshotCurrentHand` に `heroHoleCards` を追加
- 理由: 復帰時にプレイヤーの手札を正確に復元する必要があるため

### ADR-009

- 日付: 2026-02-14
- 決定: AsyncAPI の `ActionType` はクライアント送信用に限定し、サーバー起因アクションは `EventType` で表現
- 理由: WebSocket の command / event の責務分離を明確にする設計判断

## 6. 次アクション

1. OpenAPI/AsyncAPI の詳細 payload を実装レベルまで具体化
2. `GameRule` インターフェース差分をコード側に反映
3. E2E 優先シナリオ（HP-02, HP-03, HP-07, ED-05）から自動化
